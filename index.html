<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMind AI | Advanced Learning Diagnostic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #f0f5ff 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 40px;
        }

        .diagnostic-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .diagnostic-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--secondary);
            font-size: 2rem;
            font-weight: 700;
        }

        .text-input-area {
            margin-bottom: 40px;
        }

        .text-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .word-count.warning {
            color: var(--warning);
        }

        .word-count.error {
            color: var(--danger);
        }

        .text-input-container {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: 300px;
            padding: 25px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: #fdfdfd;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .text-input::placeholder {
            color: var(--gray);
        }

        .text-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .sample-text-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .sample-text-btn:hover {
            color: var(--secondary);
        }

        .processing-area {
            display: none;
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 2px dashed var(--primary-light);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            display: none;
        }

        .quiz-section {
            display: none;
            margin-top: 40px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .progress-container {
            flex: 1;
            margin-right: 30px;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 5px;
        }

        .quiz-question {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .question-type {
            background: var(--gray-light);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .conceptual { background: #e3f2fd; color: #1565c0; }
        .application { background: #e8f5e9; color: #2e7d32; }
        .factual { background: #fff3e0; color: #ef6c00; }
        .critical { background: #f3e5f5; color: #7b1fa2; }

        .question-text {
            font-size: 1.25rem;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: #f8fbff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: #f0fff4;
        }

        .option.incorrect {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option-content {
            flex: 1;
        }

        .option-explanation {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
            display: none;
        }

        .show-explanation .option-explanation {
            display: block;
        }

        .results-section {
            display: none;
            margin-top: 40px;
        }

        .profile-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px;
            margin-bottom: 25px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .confidence-meter {
            margin-bottom: 30px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .meter-bar {
            height: 12px;
            background: var(--gray-light);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1.5s ease;
            border-radius: 6px;
        }

        .topics-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .topic-item {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .topic-item.strong {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, #f0fff4, #e6ffed);
        }

        .topic-item.weak {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        .study-plan {
            background: linear-gradient(135deg, #f8fbff, #eef2ff);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid var(--accent);
        }

        .technique-recommendation {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .tech-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #ff6b9d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .steps-list {
            list-style: none;
            margin: 20px 0;
        }

        .steps-list li {
            padding: 15px 15px 15px 50px;
            position: relative;
            margin-bottom: 12px;
            background: white;
            border-radius: 8px;
        }

        .steps-list li::before {
            content: '✓';
            position: absolute;
            left: 15px;
            top: 15px;
            width: 24px;
            height: 24px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-large {
            padding: 16px 40px;
            font-size: 1.1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .alert-error {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #2e7d32;
        }

        .insight-box {
            background: linear-gradient(135deg, #f0f4ff, #e6eeff);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2.3rem; }
            .diagnostic-container { padding: 25px 20px; }
            .quiz-header { flex-direction: column; gap: 15px; }
            .profile-header { flex-direction: column; text-align: center; gap: 15px; }
            .technique-recommendation { flex-direction: column; text-align: center; gap: 15px; }
            .btn { width: 100%; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>StudyMind AI</span>
            </div>
            <nav>
                <a href="#diagnostic" style="text-decoration: none; color: var(--dark); font-weight: 500;">Diagnostic</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Advanced Learning Diagnostic System</h1>
            <p>Paste your study material. Our AI understands the content and creates intelligent quizzes with conceptual questions and detailed analysis.</p>
            <button class="btn btn-primary btn-large" id="startBtn">
                <i class="fas fa-play-circle"></i> Start Diagnostic
            </button>
        </div>
    </section>

    <section id="diagnostic" class="container">
        <div class="diagnostic-container">
            <h2 class="section-title">Intelligent Text Analysis & Quiz</h2>
            
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <div class="text-input-area">
                <div class="text-input-header">
                    <h3>Paste Your Study Content</h3>
                    <div class="word-count" id="wordCount">0 words (minimum: 150)</div>
                </div>
                
                <div class="text-input-container">
                    <textarea class="text-input" id="textInput" placeholder="Paste your textbook content, lecture notes, or study material here..."></textarea>
                </div>
                
                <div class="text-input-footer">
                    <div>
                        <i class="fas fa-info-circle"></i> Paste at least 150 words for deep analysis
                    </div>
                    <button class="sample-text-btn" id="sampleTextBtn">
                        <i class="fas fa-magic"></i> Load Sample Text
                    </button>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary btn-large" id="analyzeTextBtn">
                    <i class="fas fa-bolt"></i> Analyze & Generate Quiz
                </button>
            </div>

            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <h3>AI is Analyzing Your Content</h3>
                <p>Understanding concepts, extracting relationships, and creating diagnostic questions...</p>
            </div>

            <div class="analysis-preview" id="analysisPreview">
                <h3><i class="fas fa-robot"></i> Analysis Complete</h3>
                <div id="analysisDetails"></div>
            </div>

            <div class="quiz-section" id="quizSection">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quizProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray);">
                            <span>Progress</span>
                            <span id="progressText">Question 1 of 10</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--secondary);">Conceptual Quiz</div>
                        <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">Time: <span id="quizTime">00:00</span></div>
                    </div>
                </div>

                <div id="quizQuestions"></div>

                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                    <button class="btn btn-secondary" id="prevQuestionBtn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-large" id="submitQuizBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> Submit & Get Analysis
                    </button>
                </div>
            </div>

            <div class="results-section" id="resultsSection"></div>
        </div>
    </section>

    <script>
        class AdvancedTextUnderstandingEngine {
            constructor() {
                this.concepts = new Map();
                this.relationships = [];
                this.keySentences = [];
                this.structure = {};
            }

            deepUnderstand(text) {
                if (!text || text.trim().split(/\s+/).length < 100) {
                    throw new Error('Please provide at least 150 words for deep understanding.');
                }

                const analysis = {
                    coreConcepts: [],
                    definitions: [],
                    processes: [],
                    comparisons: [],
                    examples: [],
                    principles: [],
                    implications: [],
                    hierarchy: {},
                    difficulty: 'medium'
                };

                // Split into paragraphs and sentences
                const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 0);
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 15);
                
                // Extract core concepts based on frequency and importance
                const words = text.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
                const wordFreq = {};
                words.forEach(word => {
                    if (!this.isCommonWord(word)) {
                        wordFreq[word] = (wordFreq[word] || 0) + 1;
                    }
                });

                // Find important concepts (appear multiple times)
                const importantWords = Object.entries(wordFreq)
                    .filter(([word, freq]) => freq >= 2)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 15)
                    .map(([word]) => this.capitalizeFirst(word));

                analysis.coreConcepts = importantWords;

                // Analyze each sentence for meaning
                sentences.forEach(sentence => {
                    const lower = sentence.toLowerCase();
                    
                    // Extract definitions
                    if (this.isDefinition(sentence)) {
                        const definition = this.extractDefinition(sentence);
                        if (definition) {
                            analysis.definitions.push(definition);
                        }
                    }
                    
                    // Extract processes (steps, stages, phases)
                    if (this.isProcess(sentence)) {
                        const process = this.extractProcess(sentence);
                        if (process) {
                            analysis.processes.push(process);
                        }
                    }
                    
                    // Extract comparisons
                    if (this.isComparison(sentence)) {
                        analysis.comparisons.push(sentence);
                    }
                    
                    // Extract examples
                    if (this.isExample(sentence)) {
                        analysis.examples.push(sentence);
                    }
                    
                    // Extract principles (laws, theories, rules)
                    if (this.isPrinciple(sentence)) {
                        analysis.principles.push(sentence);
                    }
                    
                    // Extract implications (therefore, thus, hence, so)
                    if (this.isImplication(sentence)) {
                        analysis.implications.push(sentence);
                    }
                });

                // Build concept hierarchy
                analysis.hierarchy = this.buildHierarchy(analysis.coreConcepts, sentences);
                
                // Determine difficulty based on content complexity
                const complexTerms = this.countComplexTerms(text);
                analysis.difficulty = complexTerms > 10 ? 'advanced' : complexTerms > 5 ? 'intermediate' : 'beginner';

                this.analysis = analysis;
                return analysis;
            }

            isCommonWord(word) {
                const commonWords = new Set([
                    'that', 'with', 'this', 'from', 'have', 'what', 'when', 'where',
                    'which', 'there', 'their', 'about', 'would', 'could', 'should'
                ]);
                return commonWords.has(word);
            }

            isDefinition(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes(' is ') || 
                       lower.includes('defined as') || 
                       lower.includes('refers to') || 
                       lower.includes('means that') ||
                       lower.includes('known as');
            }

            extractDefinition(sentence) {
                // Find the concept being defined
                const words = sentence.split(' ');
                for (let i = 0; i < words.length; i++) {
                    if (words[i].toLowerCase() === 'is' || 
                        words[i].toLowerCase() === 'are' ||
                        words[i].toLowerCase() === 'refers' ||
                        words[i].toLowerCase() === 'means') {
                        const concept = words.slice(0, i).join(' ');
                        const definition = words.slice(i + 1).join(' ');
                        return { concept: concept.trim(), definition: definition.trim() };
                    }
                }
                return null;
            }

            isProcess(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes('step') || 
                       lower.includes('stage') || 
                       lower.includes('phase') ||
                       lower.includes('process') ||
                       lower.includes('method') ||
                       lower.includes('procedure');
            }

            extractProcess(sentence) {
                return { description: sentence, steps: this.extractSteps(sentence) };
            }

            extractSteps(sentence) {
                // Look for numbered or bulleted steps
                const stepPattern = /(\d+\.\s+|[•\-]\s+)([^.•\n]+)/g;
                const matches = [...sentence.matchAll(stepPattern)];
                return matches.map(match => match[2].trim());
            }

            isComparison(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes(' compared to ') || 
                       lower.includes(' versus ') || 
                       lower.includes(' vs ') ||
                       lower.includes(' different from ') ||
                       lower.includes(' similar to ') ||
                       lower.includes(' unlike ');
            }

            isExample(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes(' for example') || 
                       lower.includes(' e.g.') || 
                       lower.includes(' such as') ||
                       lower.includes(' including') ||
                       lower.includes(' like ');
            }

            isPrinciple(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes(' principle') || 
                       lower.includes(' law ') || 
                       lower.includes(' theory ') ||
                       lower.includes(' rule ') ||
                       lower.includes(' concept ');
            }

            isImplication(sentence) {
                const lower = sentence.toLowerCase();
                return lower.includes(' therefore') || 
                       lower.includes(' thus ') || 
                       lower.includes(' hence ') ||
                       lower.includes(' consequently') ||
                       lower.includes(' so ') ||
                       lower.includes(' as a result');
            }

            countComplexTerms(text) {
                const complexPatterns = [
                    /[A-Z][a-z]+\s+[A-Z][a-z]+/g,  // Multi-word proper nouns
                    /[A-Z][A-Z]+/g,               // Acronyms
                    /\b\w+ity\b/g,                // Words ending in -ity
                    /\b\w+tion\b/g,               // Words ending in -tion
                    /\b\w+ism\b/g                 // Words ending in -ism
                ];
                
                let count = 0;
                complexPatterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) count += matches.length;
                });
                
                return count;
            }

            buildHierarchy(concepts, sentences) {
                const hierarchy = {};
                
                concepts.forEach(concept => {
                    hierarchy[concept] = {
                        parents: [],
                        children: [],
                        related: [],
                        level: 1
                    };
                });

                // Find relationships between concepts
                sentences.forEach(sentence => {
                    concepts.forEach(concept => {
                        if (sentence.includes(concept)) {
                            // Find other concepts in the same sentence
                            concepts.forEach(otherConcept => {
                                if (otherConcept !== concept && sentence.includes(otherConcept)) {
                                    if (!hierarchy[concept].related.includes(otherConcept)) {
                                        hierarchy[concept].related.push(otherConcept);
                                    }
                                }
                            });
                        }
                    });
                });

                return hierarchy;
            }

            capitalizeFirst(word) {
                return word.charAt(0).toUpperCase() + word.slice(1);
            }

            generateIntelligentQuestions(analysis, count = 10) {
                const questions = [];
                
                if (analysis.coreConcepts.length < 3) {
                    throw new Error('Need more content to generate meaningful questions.');
                }

                // Question templates with specific contexts
                const templates = {
                    conceptual: [
                        "Based on the explanation provided, what is the fundamental purpose of {concept}?",
                        "How would you describe the core function of {concept} according to the text?",
                        "What key insight about {concept} is emphasized in the material?",
                        "According to the text, what makes {concept} significant or unique?"
                    ],
                    application: [
                        "Given the information about {concept}, how would you apply it in a practical scenario?",
                        "If you encountered a situation involving {concept}, what approach would be most appropriate based on the text?",
                        "What real-world problem could be solved using the principles of {concept} as described?",
                        "Based on the examples provided, where would {concept} be most effectively utilized?"
                    ],
                    relational: [
                        "How does {concept} relate to {relatedConcept} according to the text?",
                        "What is the key difference between {concept} and {relatedConcept} as described?",
                        "Based on the comparison made, what distinguishes {concept} from similar ideas?",
                        "How are {concept} and {relatedConcept} connected in the system described?"
                    ],
                    analytical: [
                        "What would be the most likely consequence if {concept} was absent or malfunctioning?",
                        "Based on the implications discussed, what can be inferred about the importance of {concept}?",
                        "What assumption underlies the functioning of {concept} as described?",
                        "How does understanding {concept} contribute to the broader picture presented?"
                    ]
                };

                // Generate questions based on analysis
                for (let i = 0; i < count; i++) {
                    const concept = analysis.coreConcepts[i % analysis.coreConcepts.length];
                    let questionType, questionText;
                    
                    // Distribute question types
                    if (i < 4) {
                        questionType = 'conceptual';
                        questionText = templates.conceptual[i % templates.conceptual.length].replace('{concept}', concept);
                    } else if (i < 7) {
                        questionType = 'application';
                        questionText = templates.application[(i-4) % templates.application.length].replace('{concept}', concept);
                    } else if (i < 9) {
                        questionType = 'relational';
                        const related = analysis.coreConcepts[(i+1) % analysis.coreConcepts.length];
                        questionText = templates.relational[(i-7) % templates.relational.length]
                            .replace('{concept}', concept)
                            .replace('{relatedConcept}', related);
                    } else {
                        questionType = 'analytical';
                        questionText = templates.analytical[(i-9) % templates.analytical.length].replace('{concept}', concept);
                    }

                    const { options, correctIndex, explanation } = this.generateContextualOptions(concept, questionType, analysis);
                    
                    questions.push({
                        id: i + 1,
                        type: questionType,
                        concept: concept,
                        text: questionText,
                        options: options,
                        correctAnswer: correctIndex,
                        explanation: explanation,
                        difficulty: analysis.difficulty
                    });
                }

                return questions;
            }

            generateContextualOptions(concept, type, analysis) {
                let correctAnswer = '';
                let explanation = '';
                
                // Find relevant information for correct answer
                if (analysis.definitions.length > 0) {
                    const relevantDef = analysis.definitions.find(d => 
                        d.concept.toLowerCase().includes(concept.toLowerCase()) ||
                        concept.toLowerCase().includes(d.concept.toLowerCase())
                    );
                    if (relevantDef) {
                        correctAnswer = relevantDef.definition;
                        explanation = `This directly matches the definition provided in the text: "${relevantDef.definition}"`;
                    }
                }

                // If no definition found, use other analysis
                if (!correctAnswer) {
                    // Look for sentences mentioning the concept
                    const relevantSentences = analysis.sentences?.filter(s => 
                        s.toLowerCase().includes(concept.toLowerCase())
                    ) || [];
                    
                    if (relevantSentences.length > 0) {
                        const sentence = relevantSentences[0];
                        correctAnswer = this.extractKeyInformation(sentence, concept);
                        explanation = `This answer is derived from: "${sentence.substring(0, 100)}..."`;
                    } else {
                        // Generate logical answer based on concept type
                        correctAnswer = this.generateLogicalAnswer(concept, type);
                        explanation = `This represents the most accurate understanding of ${concept} based on the text's context.`;
                    }
                }

                // Generate intelligent distractors
                const distractors = this.generateIntelligentDistractors(concept, type, analysis, correctAnswer);
                
                // Combine and shuffle
                const allOptions = [correctAnswer, ...distractors];
                const shuffled = this.shuffleArray([...allOptions]);
                const correctIndex = shuffled.indexOf(correctAnswer);

                return {
                    options: shuffled,
                    correctIndex: correctIndex,
                    explanation: explanation
                };
            }

            extractKeyInformation(sentence, concept) {
                // Extract the most informative part of the sentence
                const words = sentence.split(' ');
                const conceptIndex = words.findIndex(w => 
                    w.toLowerCase().includes(concept.toLowerCase())
                );
                
                if (conceptIndex !== -1) {
                    const start = Math.max(0, conceptIndex - 3);
                    const end = Math.min(words.length, conceptIndex + 7);
                    return words.slice(start, end).join(' ');
                }
                
                return sentence.substring(0, 80) + '...';
            }

            generateLogicalAnswer(concept, type) {
                const answers = {
                    conceptual: `It serves a fundamental role as described, forming the basis for understanding related concepts.`,
                    application: `It can be practically applied in situations where its specific characteristics are needed.`,
                    relational: `It interacts with other elements in the system as described in the text.`,
                    analytical: `Its importance lies in how it contributes to the overall functioning described.`
                };
                return answers[type] || `This represents the key understanding of ${concept} from the material.`;
            }

            generateIntelligentDistractors(concept, type, analysis, correctAnswer) {
                const distractors = [];
                
                // Distractor 1: Opposite of correct
                if (correctAnswer.includes(' not ') || correctAnswer.includes('never ') || correctAnswer.includes('no ')) {
                    distractors.push(correctAnswer.replace('not ', '').replace('never ', 'always ').replace('no ', 'yes '));
                } else {
                    distractors.push(`This represents the opposite of what the text states about ${concept}.`);
                }
                
                // Distractor 2: Overgeneralization
                distractors.push(`This is too broad and doesn't capture the specific nature of ${concept} as described.`);
                
                // Distractor 3: Misattribution (confuse with related concept)
                if (analysis.coreConcepts.length > 1) {
                    const otherConcepts = analysis.coreConcepts.filter(c => c !== concept);
                    if (otherConcepts.length > 0) {
                        const randomConcept = otherConcepts[Math.floor(Math.random() * otherConcepts.length)];
                        distractors.push(`This actually describes ${randomConcept}, not ${concept}.`);
                    }
                }
                
                // Distractor 4: Common misconception
                distractors.push(`This is a common misunderstanding that contradicts the text's explanation.`);
                
                return distractors.slice(0, 3); // Return only 3 distractors
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            analyzePerformance(questions, answers) {
                const analysis = {
                    total: questions.length,
                    correct: 0,
                    accuracy: 0,
                    conceptScores: {},
                    typeScores: {
                        conceptual: { correct: 0, total: 0 },
                        application: { correct: 0, total: 0 },
                        relational: { correct: 0, total: 0 },
                        analytical: { correct: 0, total: 0 }
                    },
                    responsePatterns: {
                        consistent: true,
                        strengths: [],
                        weaknesses: []
                    }
                };

                questions.forEach((question, index) => {
                    const qid = question.id.toString();
                    const isCorrect = answers[qid] === question.correctAnswer;
                    
                    if (isCorrect) analysis.correct++;
                    
                    // Track concept performance
                    if (!analysis.conceptScores[question.concept]) {
                        analysis.conceptScores[question.concept] = { correct: 0, total: 0 };
                    }
                    analysis.conceptScores[question.concept].total++;
                    if (isCorrect) analysis.conceptScores[question.concept].correct++;
                    
                    // Track type performance
                    analysis.typeScores[question.type].total++;
                    if (isCorrect) analysis.typeScores[question.type].correct++;
                });

                analysis.accuracy = (analysis.correct / analysis.total) * 100;
                
                // Calculate consistency
                const typeAccuracies = [];
                for (const [type, data] of Object.entries(analysis.typeScores)) {
                    if (data.total > 0) {
                        typeAccuracies.push((data.correct / data.total) * 100);
                    }
                }
                
                const maxDiff = Math.max(...typeAccuracies) - Math.min(...typeAccuracies);
                analysis.responsePatterns.consistent = maxDiff < 30;
                
                return analysis;
            }

            determineLearningProfile(analysis) {
                const typeScores = {};
                for (const [type, data] of Object.entries(analysis.typeScores)) {
                    if (data.total > 0) {
                        typeScores[type] = (data.correct / data.total) * 100;
                    }
                }

                const conceptualScore = typeScores.conceptual || 0;
                const applicationScore = typeScores.application || 0;
                const relationalScore = typeScores.relational || 0;
                const analyticalScore = typeScores.analytical || 0;

                let profile = {
                    type: 'Comprehensive Learner',
                    description: 'You show balanced understanding across different types of reasoning.',
                    icon: 'fa-balance-scale',
                    color: '#4361ee',
                    strengths: ['Balanced skills', 'Adaptive thinking'],
                    weaknesses: []
                };

                // Determine specialized profile
                if (conceptualScore >= 80 && relationalScore >= 70) {
                    profile.type = 'Conceptual Master';
                    profile.description = 'You excel at understanding fundamental principles and their relationships.';
                    profile.icon = 'fa-lightbulb';
                    profile.color = '#f8961e';
                    profile.strengths = ['Conceptual understanding', 'Making connections'];
                    profile.weaknesses = ['Practical application', 'Detailed execution'];
                } else if (applicationScore >= 80 && analyticalScore >= 70) {
                    profile.type = 'Practical Problem Solver';
                    profile.description = 'You are excellent at applying concepts to real situations and analyzing outcomes.';
                    profile.icon = 'fa-cogs';
                    profile.color = '#4cc9f0';
                    profile.strengths = ['Practical application', 'Analytical thinking'];
                    profile.weaknesses = ['Theoretical depth', 'Abstract concepts'];
                } else if (relationalScore >= 80 && analyticalScore >= 70) {
                    profile.type = 'Analytical Thinker';
                    profile.description = 'You excel at making connections between ideas and drawing insightful conclusions.';
                    profile.icon = 'fa-search';
                    profile.color = '#9d4edd';
                    profile.strengths = ['Relational thinking', 'Critical analysis'];
                    profile.weaknesses = ['Basic concepts', 'Simple applications'];
                } else if (conceptualScore >= 70 && applicationScore < 50) {
                    profile.type = 'Theoretical Learner';
                    profile.description = 'You understand concepts well but need more practice with applications.';
                    profile.icon = 'fa-book';
                    profile.color = '#f72585';
                    profile.strengths = ['Theoretical understanding', 'Conceptual clarity'];
                    profile.weaknesses = ['Practical application', 'Real-world connections'];
                }

                return profile;
            }

            generateStudyPlan(profile, analysis, questions) {
                // Identify strong and weak concepts
                const strongConcepts = [];
                const weakConcepts = [];
                
                for (const [concept, data] of Object.entries(analysis.conceptScores)) {
                    const accuracy = (data.correct / data.total) * 100;
                    if (accuracy >= 80) {
                        strongConcepts.push(concept);
                    } else if (accuracy <= 50) {
                        weakConcepts.push(concept);
                    }
                }

                // Techniques based on profile
                const techniqueMap = {
                    'Conceptual Master': ['Feynman Technique', 'Concept Mapping', 'Teaching Others'],
                    'Practical Problem Solver': ['Case Studies', 'Real-world Projects', 'Problem-based Learning'],
                    'Analytical Thinker': ['Socratic Questioning', 'Critical Analysis Exercises', 'Debate Practice'],
                    'Theoretical Learner': ['Applied Practice', 'Scenario-based Learning', 'Practical Examples'],
                    'Comprehensive Learner': ['Interleaving', 'Mixed Practice', 'Holistic Review']
                };

                const techniques = techniqueMap[profile.type] || ['Active Recall', 'Spaced Repetition', 'Practice Testing'];

                // Generate personalized study plan
                const studyPlan = [];
                
                if (weakConcepts.length > 0) {
                    studyPlan.push(`Focus intensive study on: ${weakConcepts.slice(0, 3).join(', ')}`);
                }
                
                studyPlan.push(`Use ${techniques[0]} to strengthen ${profile.weaknesses.length > 0 ? profile.weaknesses[0] : 'understanding'}`);
                studyPlan.push('Create concept maps linking key ideas together');
                studyPlan.push('Practice explaining each concept in your own words');
                
                if (strongConcepts.length > 0) {
                    studyPlan.push(`Use strong concepts (${strongConcepts.slice(0, 2).join(', ')}) as anchors for new learning`);
                }
                
                studyPlan.push('Regularly test yourself with varied question types');
                studyPlan.push('Connect concepts to real-world applications');

                return {
                    techniques: techniques,
                    studyPlan: studyPlan,
                    strongConcepts: strongConcepts.slice(0, 5),
                    weakConcepts: weakConcepts.slice(0, 5),
                    dailyTime: '60 minutes (20 min review, 20 min practice, 20 min application)',
                    focusRatio: '50% weak areas, 30% new connections, 20% review',
                    avoid: [
                        'Passive reading without active engagement',
                        'Focusing only on comfortable topics',
                        'Cramming without understanding',
                        'Ignoring practical applications'
                    ],
                    insights: this.generateInsights(profile, analysis)
                };
            }

            generateInsights(profile, analysis) {
                const insights = [];
                
                if (analysis.accuracy >= 80) {
                    insights.push('You have a strong foundational understanding of the material.');
                } else if (analysis.accuracy >= 60) {
                    insights.push('You have a good foundation but need to strengthen some areas.');
                } else {
                    insights.push('Focus on building a solid understanding of core concepts first.');
                }

                if (analysis.responsePatterns.consistent) {
                    insights.push('Your performance is consistent across different question types.');
                } else {
                    insights.push('Your performance varies significantly between different types of questions.');
                }

                if (profile.weaknesses.length > 0) {
                    insights.push(`Pay special attention to: ${profile.weaknesses.join(', ')}`);
                }

                return insights;
            }
        }

        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            const aiEngine = new AdvancedTextUnderstandingEngine();
            let currentQuestions = [];
            let userAnswers = {};
            let quizStartTime = null;
            let timerInterval = null;
            let currentQuestion = 0;

            // DOM Elements
            const elements = {
                textInput: document.getElementById('textInput'),
                wordCount: document.getElementById('wordCount'),
                analyzeBtn: document.getElementById('analyzeTextBtn'),
                processing: document.getElementById('processingArea'),
                analysisPreview: document.getElementById('analysisPreview'),
                analysisDetails: document.getElementById('analysisDetails'),
                quizSection: document.getElementById('quizSection'),
                quizQuestions: document.getElementById('quizQuestions'),
                progressText: document.getElementById('progressText'),
                quizProgress: document.getElementById('quizProgress'),
                prevBtn: document.getElementById('prevQuestionBtn'),
                nextBtn: document.getElementById('nextQuestionBtn'),
                submitBtn: document.getElementById('submitQuizBtn'),
                resultsSection: document.getElementById('resultsSection'),
                errorAlert: document.getElementById('errorAlert'),
                successAlert: document.getElementById('successAlert')
            };

            // Word count tracking
            elements.textInput.addEventListener('input', function() {
                const text = this.value.trim();
                const words = text === '' ? 0 : text.split(/\s+/).length;
                elements.wordCount.textContent = `${words} words (minimum: 150)`;
                
                if (words >= 150) {
                    elements.wordCount.className = 'word-count';
                    elements.analyzeBtn.disabled = false;
                } else if (words >= 100) {
                    elements.wordCount.className = 'word-count warning';
                    elements.analyzeBtn.disabled = true;
                } else {
                    elements.wordCount.className = 'word-count error';
                    elements.analyzeBtn.disabled = true;
                }
            });

            // Load sample text
            document.getElementById('sampleTextBtn').addEventListener('click', function() {
                const sampleText = `Photosynthesis: The Fundamental Energy Conversion Process

Photosynthesis is the biochemical process by which plants, algae, and some bacteria convert light energy into chemical energy stored in organic compounds like glucose. This process is fundamental to life on Earth because it produces oxygen and forms the base of most food chains.

The process occurs in two main stages:
1. Light-dependent reactions take place in the thylakoid membranes of chloroplasts. Chlorophyll molecules absorb light energy, which excites electrons and splits water molecules into oxygen, protons, and electrons. This stage generates ATP and NADPH as energy carriers.

2. Calvin cycle (light-independent reactions) occurs in the stroma of chloroplasts. Here, carbon dioxide is fixed and converted into glucose using the ATP and NADPH produced in the light reactions. The enzyme RuBisCO catalyzes the first step of carbon fixation.

Key factors affecting photosynthesis rate:
- Light intensity: Increases rate until saturation point
- Carbon dioxide concentration: Limited by atmospheric levels
- Temperature: Optimal around 25-30°C for most plants
- Water availability: Essential for electron transport

Plants have evolved adaptations to optimize photosynthesis. C4 plants like corn use a specialized pathway to concentrate CO2, while CAM plants like cacti open stomata at night to minimize water loss.

The importance of photosynthesis extends beyond energy production. It regulates atmospheric gases, supports ecosystems, and provides the foundation for virtually all life through food chains. Understanding photosynthesis is crucial for addressing climate change and improving agricultural productivity.`;
                
                elements.textInput.value = sampleText;
                elements.textInput.dispatchEvent(new Event('input'));
            });

            // Start diagnostic
            document.getElementById('startBtn').addEventListener('click', function() {
                document.getElementById('diagnostic').scrollIntoView({ behavior: 'smooth' });
                elements.textInput.focus();
            });

            // Analyze text and generate quiz
            elements.analyzeBtn.addEventListener('click', function() {
                const text = elements.textInput.value.trim();
                
                if (text.split(/\s+/).length < 100) {
                    showError('Please enter at least 100 words for proper analysis.');
                    return;
                }
                
                elements.processing.style.display = 'block';
                elements.analyzeBtn.disabled = true;
                
                // Process with delay to simulate AI thinking
                setTimeout(() => {
                    try {
                        // Deep analysis
                        const analysis = aiEngine.deepUnderstand(text);
                        
                        // Generate intelligent questions
                        currentQuestions = aiEngine.generateIntelligentQuestions(analysis, 10);
                        
                        // Show analysis preview
                        elements.analysisDetails.innerHTML = `
                            <p><i class="fas fa-check-circle"></i> Understood ${analysis.coreConcepts.length} core concepts</p>
                            <p><i class="fas fa-tags"></i> Identified ${analysis.definitions.length} key definitions</p>
                            <p><i class="fas fa-sitemap"></i> Mapped ${Object.keys(analysis.hierarchy).length} relationships</p>
                            <p><i class="fas fa-brain"></i> Generated conceptual questions at ${analysis.difficulty} level</p>
                        `;
                        elements.analysisPreview.style.display = 'block';
                        
                        showSuccess('Deep analysis complete! Ready to generate intelligent quiz.');
                        
                        // Start quiz
                        setTimeout(() => startQuiz(), 1000);
                        
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        elements.processing.style.display = 'none';
                        elements.analyzeBtn.disabled = false;
                    }
                }, 2000);
            });

            // Start quiz
            function startQuiz() {
                if (!currentQuestions || currentQuestions.length === 0) return;
                
                elements.quizSection.style.display = 'block';
                currentQuestion = 0;
                userAnswers = {};
                quizStartTime = Date.now();
                
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
                
                renderQuestion();
                updateNavigation();
                
                elements.quizSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Render question
            function renderQuestion() {
                if (!currentQuestions || !currentQuestions[currentQuestion]) return;
                
                const question = currentQuestions[currentQuestion];
                elements.progressText.textContent = `Question ${currentQuestion + 1} of ${currentQuestions.length}`;
                
                const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
                elements.quizProgress.style.width = `${progress}%`;
                
                // Get question type styling
                const typeClass = question.type;
                const typeIcon = {
                    conceptual: 'fa-lightbulb',
                    application: 'fa-cogs',
                    relational: 'fa-sitemap',
                    analytical: 'fa-search'
                }[question.type] || 'fa-question';
                
                // Generate options HTML
                let optionsHTML = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                question.options.forEach((option, index) => {
                    let optionClass = 'option';
                    const qid = question.id.toString();
                    if (userAnswers[qid] === index) {
                        optionClass += ' selected';
                    }
                    
                    optionsHTML += `
                        <div class="${optionClass}" data-index="${index}" data-question="${qid}">
                            <div class="option-letter">${letters[index]}</div>
                            <div class="option-content">
                                <div>${option}</div>
                            </div>
                        </div>
                    `;
                });
                
                // Build question HTML
                elements.quizQuestions.innerHTML = `
                    <div class="quiz-question">
                        <div class="question-meta">
                            <div class="question-type ${typeClass}">
                                <i class="fas ${typeIcon}"></i> ${question.type.charAt(0).toUpperCase() + question.type.slice(1)}
                            </div>
                            <div>
                                <i class="fas fa-tag"></i> ${question.concept}
                            </div>
                        </div>
                        <div class="question-text">
                            ${question.text}
                        </div>
                        <div class="options-grid">
                            ${optionsHTML}
                        </div>
                    </div>
                `;
                
                // Add event listeners to options
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        const questionId = this.getAttribute('data-question');
                        
                        document.querySelectorAll(`[data-question="${questionId}"]`).forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        userAnswers[questionId] = selectedIndex;
                        
                        const allAnswered = Object.keys(userAnswers).length === currentQuestions.length;
                        elements.submitBtn.style.display = allAnswered ? 'block' : 'none';
                    });
                });
            }

            // Navigation
            elements.nextBtn.addEventListener('click', () => {
                if (currentQuestion < currentQuestions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                    updateNavigation();
                }
            });

            elements.prevBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    updateNavigation();
                }
            });

            function updateNavigation() {
                elements.prevBtn.disabled = currentQuestion === 0;
                elements.nextBtn.disabled = currentQuestion === currentQuestions.length - 1;
            }

            // Timer
            function updateTimer() {
                if (!quizStartTime) return;
                
                const now = Date.now();
                const diff = Math.floor((now - quizStartTime) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                
                document.getElementById('quizTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Submit quiz
            elements.submitBtn.addEventListener('click', function() {
                clearInterval(timerInterval);
                const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
                
                elements.submitBtn.disabled = true;
                elements.submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
                
                setTimeout(() => {
                    try {
                        const performance = aiEngine.analyzePerformance(currentQuestions, userAnswers);
                        const profile = aiEngine.determineLearningProfile(performance);
                        const studyPlan = aiEngine.generateStudyPlan(profile, performance, currentQuestions);
                        
                        showResults(performance, profile, studyPlan, timeTaken);
                        
                    } catch (error) {
                        showError('Error analyzing results: ' + error.message);
                    } finally {
                        elements.submitBtn.disabled = false;
                        elements.submitBtn.innerHTML = '<i class="fas fa-chart-line"></i> Submit & Get Analysis';
                    }
                }, 1500);
            });

            // Show results
            function showResults(performance, profile, studyPlan, timeTaken) {
                elements.quizSection.style.display = 'none';
                elements.resultsSection.style.display = 'block';
                
                // Create topics breakdown
                let topicsHTML = '';
                
                if (studyPlan.strongConcepts.length > 0) {
                    studyPlan.strongConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item strong">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--success);">Strong</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">Excellent understanding demonstrated</p>
                            </div>
                        `;
                    });
                }
                
                if (studyPlan.weakConcepts.length > 0) {
                    studyPlan.weakConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item weak">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--danger);">Needs Focus</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">Priority area for improvement</p>
                            </div>
                        `;
                    });
                }
                
                // Create study plan steps
                let studyPlanHTML = '';
                studyPlan.studyPlan.forEach((step, index) => {
                    studyPlanHTML += `<li>${step}</li>`;
                });
                
                // Create insights
                let insightsHTML = '';
                if (studyPlan.insights && studyPlan.insights.length > 0) {
                    insightsHTML = `
                        <div class="insight-box">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;"><i class="fas fa-eye"></i> Key Insights</h4>
                            <ul style="padding-left: 20px; color: var(--gray);">
                                ${studyPlan.insights.map(insight => `<li>${insight}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Build results HTML
                elements.resultsSection.innerHTML = `
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-icon" style="background: linear-gradient(135deg, ${profile.color}, ${profile.color}dd);">
                                <i class="fas ${profile.icon}"></i>
                            </div>
                            <div style="flex: 1;">
                                <h2 style="color: var(--secondary); margin-bottom: 10px;">Learning Profile Analysis</h2>
                                <h3 style="color: ${profile.color}; margin-bottom: 10px;">${profile.type}</h3>
                                <p style="color: var(--gray); line-height: 1.6;">${profile.description}</p>
                                ${profile.strengths.length > 0 ? `<p style="margin-top: 10px;"><strong>Your Strengths:</strong> ${profile.strengths.join(', ')}</p>` : ''}
                                ${profile.weaknesses.length > 0 ? `<p><strong>Areas for Growth:</strong> ${profile.weaknesses.join(', ')}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="confidence-meter">
                            <div class="meter-label">
                                <span style="font-size: 1.1rem;">Diagnostic Score</span>
                                <strong style="font-size: 1.5rem; color: ${performance.accuracy >= 70 ? 'var(--success)' : performance.accuracy >= 50 ? 'var(--warning)' : 'var(--danger)'};">${performance.accuracy.toFixed(1)}%</strong>
                            </div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: ${performance.accuracy}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                                <span>${performance.correct} / ${performance.total} correct</span>
                                <span>Time: ${Math.floor(timeTaken/60)}:${(timeTaken%60).toString().padStart(2, '0')}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${topicsHTML ? `
                    <div class="profile-card">
                        <h3 style="color: var(--secondary); margin-bottom: 20px;">
                            <i class="fas fa-chart-bar"></i> Concept Mastery Analysis
                        </h3>
                        <div class="topics-breakdown">
                            ${topicsHTML}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${insightsHTML}
                    
                    <div class="study-plan">
                        <div class="technique-recommendation">
                            <div class="tech-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--secondary); margin-bottom: 10px;">Personalized Learning Strategy</h3>
                                <p style="color: var(--gray);"><strong>Recommended Techniques:</strong> ${studyPlan.techniques.join(', ')}</p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--secondary); margin: 20px 0 15px;">Action Plan:</h4>
                        <ol class="steps-list">
                            ${studyPlanHTML}
                        </ol>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 25px 0;">
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--secondary); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-clock"></i> Recommended Schedule</h4>
                                <p style="font-size: 0.9rem; color: var(--gray);">${studyPlan.dailyTime}</p>
                                <p style="font-size: 0.9rem; color: var(--gray);">Focus Ratio: ${studyPlan.focusRatio}</p>
                            </div>
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--danger); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> Common Pitfalls</h4>
                                <ul style="padding-left: 20px; font-size: 0.9rem; color: var(--gray);">
                                    ${studyPlan.avoid.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn btn-primary" id="newDiagnosticBtn">
                                <i class="fas fa-redo"></i> Start New Diagnostic
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listener for new diagnostic
                document.getElementById('newDiagnosticBtn').addEventListener('click', function() {
                    location.reload();
                });
                
                // Animate progress bar
                setTimeout(() => {
                    const fill = document.querySelector('.meter-fill');
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                }, 300);
                
                elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Utility functions
            function showError(message) {
                elements.errorAlert.textContent = message;
                elements.errorAlert.style.display = 'block';
                setTimeout(() => {
                    elements.errorAlert.style.display = 'none';
                }, 5000);
            }

            function showSuccess(message) {
                elements.successAlert.textContent = message;
                elements.successAlert.style.display = 'block';
                setTimeout(() => {
                    elements.successAlert.style.display = 'none';
                }, 5000);
            }

            // Initialize
            elements.textInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
