<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMind AI | Diagnostic Learning System</title>
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #f0f5ff 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.2rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--gray);
            margin-bottom: 40px;
        }

        /* Diagnostic Section */
        .diagnostic-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 50px;
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .diagnostic-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--secondary);
            font-size: 2.2rem;
            font-weight: 700;
        }

        /* Text Input Area */
        .text-input-area {
            margin-bottom: 40px;
        }

        .text-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .word-count.warning {
            color: var(--warning);
        }

        .word-count.error {
            color: var(--danger);
        }

        .text-input-container {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: 250px;
            padding: 25px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: #fdfdfd;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .text-input::placeholder {
            color: var(--gray);
        }

        .text-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .sample-text-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .sample-text-btn:hover {
            color: var(--secondary);
        }

        /* Processing Animation */
        .processing-area {
            display: none;
            text-align: center;
            padding: 50px 30px;
            background: linear-gradient(135deg, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 2px dashed var(--primary-light);
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quiz Section */
        .quiz-section {
            display: none;
            margin-top: 50px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .progress-container {
            flex: 1;
            margin-right: 30px;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 5px;
        }

        .quiz-question {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 35px;
            margin-bottom: 30px;
            border-left: 6px solid var(--primary);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .question-type {
            background: var(--gray-light);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .conceptual { background: #e3f2fd; color: #1565c0; }
        .application { background: #e8f5e9; color: #2e7d32; }
        .definition { background: #fff3e0; color: #ef6c00; }

        .question-text {
            font-size: 1.25rem;
            margin-bottom: 30px;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 15px;
        }

        .option {
            padding: 20px 25px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 20px;
            background: white;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: #f8fbff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .option.selected {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.1);
        }

        .option-letter {
            width: 40px;
            height: 40px;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .selected .option-letter {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        /* Results Section */
        .results-section {
            display: none;
            margin-top: 50px;
        }

        .profile-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 30px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 40px;
        }

        .profile-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .confidence-meter {
            margin-bottom: 40px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .meter-bar {
            height: 14px;
            background: var(--gray-light);
            border-radius: 7px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 7px;
        }

        .topics-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .topic-item {
            padding: 25px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .topic-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .topic-item.strong {
            border-left: 5px solid var(--success);
            background: linear-gradient(135deg, #f0fff4, #e6ffed);
        }

        .topic-item.weak {
            border-left: 5px solid var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        /* Buttons */
        .btn {
            padding: 16px 35px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .btn-large {
            padding: 18px 45px;
            font-size: 1.1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .alert-error {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>StudyMind AI</span>
            </div>
            <nav>
                <a href="#diagnostic" style="text-decoration: none; color: var(--dark); font-weight: 500;">Diagnostic</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>AI-Powered Diagnostic Learning System</h1>
            <p>Paste your study material. Get a personalized diagnostic quiz, learning profile analysis, and custom study plan designed for you.</p>
            <button class="btn btn-primary btn-large" id="startBtn">
                <i class="fas fa-play-circle"></i> Start Diagnostic
            </button>
        </div>
    </section>

    <!-- Diagnostic Section -->
    <section id="diagnostic" class="container">
        <div class="diagnostic-container">
            <h2 class="section-title">AI Text Analysis & Diagnostic Quiz</h2>
            
            <!-- Alert Messages -->
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <!-- Text Input Area -->
            <div class="text-input-area">
                <div class="text-input-header">
                    <h3>Paste Your Study Content</h3>
                    <div class="word-count" id="wordCount">0 words (minimum: 50)</div>
                </div>
                
                <div class="text-input-container">
                    <textarea class="text-input" id="textInput" placeholder="Paste your textbook content, lecture notes, or study material here..."></textarea>
                </div>
                
                <div class="text-input-footer">
                    <div>
                        <i class="fas fa-info-circle"></i> Paste at least 50 words for accurate analysis
                    </div>
                    <button class="sample-text-btn" id="sampleTextBtn">
                        <i class="fas fa-magic"></i> Load Sample Text
                    </button>
                </div>
            </div>

            <!-- Generate Quiz Button -->
            <div style="text-align: center;">
                <button class="btn btn-primary btn-large" id="analyzeTextBtn">
                    <i class="fas fa-bolt"></i> Analyze Text & Generate Quiz
                </button>
            </div>

            <!-- Processing Animation -->
            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <h3>AI is Analyzing Your Content</h3>
                <p>Extracting key concepts, identifying main topics, and generating personalized questions...</p>
            </div>

            <!-- Quiz Section -->
            <div class="quiz-section" id="quizSection">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quizProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray);">
                            <span>Progress</span>
                            <span id="progressText">Question 1 of 10</span>
                        </div>
                    </div>
                    <div style="text-align: right; min-width: 150px;">
                        <div style="font-weight: 700; font-size: 1.2rem; color: var(--secondary);">AI Diagnostic Quiz</div>
                        <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">Time: <span id="quizTime">00:00</span></div>
                    </div>
                </div>

                <div id="quizQuestions">
                    <!-- Questions will be inserted here -->
                </div>

                <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                    <button class="btn btn-secondary" id="prevQuestionBtn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn">
                        Next Question <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-primary btn-large" id="submitQuizBtn" style="display: none; padding: 18px 50px;">
                        <i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <!-- Results will be inserted here -->
            </div>
        </div>
    </section>

    <script>
        // DOM Elements
        const textInput = document.getElementById('textInput');
        const wordCount = document.getElementById('wordCount');
        const analyzeTextBtn = document.getElementById('analyzeTextBtn');
        const processingArea = document.getElementById('processingArea');
        const quizSection = document.getElementById('quizSection');
        const quizQuestions = document.getElementById('quizQuestions');
        const progressText = document.getElementById('progressText');
        const quizProgress = document.getElementById('quizProgress');
        const prevQuestionBtn = document.getElementById('prevQuestionBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const submitQuizBtn = document.getElementById('submitQuizBtn');
        const resultsSection = document.getElementById('resultsSection');
        const errorAlert = document.getElementById('errorAlert');
        const successAlert = document.getElementById('successAlert');

        // State
        let currentQuestion = 0;
        let userAnswers = {};
        let quizData = null;
        let sessionId = null;
        let quizStartTime = null;
        let timerInterval = null;

        // Word count tracking
        textInput.addEventListener('input', function() {
            const text = this.value.trim();
            const words = text === '' ? 0 : text.split(/\s+/).length;
            wordCount.textContent = `${words} words (minimum: 50)`;
            
            if (words >= 50) {
                wordCount.className = 'word-count';
                analyzeTextBtn.disabled = false;
            } else if (words >= 25) {
                wordCount.className = 'word-count warning';
                analyzeTextBtn.disabled = true;
            } else {
                wordCount.className = 'word-count error';
                analyzeTextBtn.disabled = true;
            }
        });

        // Load sample text
        document.getElementById('sampleTextBtn').addEventListener('click', function() {
            const sampleText = `Photosynthesis is the process used by plants, algae, and some bacteria to convert light energy into chemical energy. This process occurs in chloroplasts and involves two main stages: the light-dependent reactions and the Calvin cycle.

Light-dependent Reactions:
These reactions occur in the thylakoid membranes of chloroplasts. Chlorophyll absorbs light energy, which splits water molecules into oxygen, protons, and electrons. The energy from these reactions is stored in ATP and NADPH.

Calvin Cycle:
Also known as the light-independent reactions, this cycle takes place in the stroma of chloroplasts. Here, carbon dioxide is fixed and converted into glucose using the ATP and NADPH produced in the light reactions. The enzyme RuBisCO catalyzes the first major step of carbon fixation.

Importance of Photosynthesis:
Photosynthesis is crucial for life on Earth as it produces oxygen and forms the base of most food chains. The overall chemical equation is: 6CO₂ + 6H₂O + light energy → C₆H₁₂O₆ + 6O₂.

Factors Affecting Photosynthesis:
Light intensity, carbon dioxide concentration, temperature, and water availability all affect the rate of photosynthesis. Plants have adapted various mechanisms to optimize photosynthesis, such as C4 and CAM pathways in plants living in hot, dry environments.`;
            
            textInput.value = sampleText;
            textInput.dispatchEvent(new Event('input'));
        });

        // Start diagnostic
        document.getElementById('startBtn').addEventListener('click', function() {
            document.getElementById('diagnostic').scrollIntoView({ behavior: 'smooth' });
            textInput.focus();
        });

        // Analyze text and generate quiz
        analyzeTextBtn.addEventListener('click', async function() {
            const text = textInput.value.trim();
            
            if (text.split(/\s+/).length < 50) {
                showError('Please enter at least 50 words for accurate analysis.');
                return;
            }
            
            // Show processing
            processingArea.style.display = 'block';
            analyzeTextBtn.disabled = true;
            
            try {
                // Send to backend
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Analysis failed');
                }
                
                // Store quiz data
                quizData = data.quiz;
                sessionId = data.session_id;
                
                // Show success
                showSuccess(`Analysis complete! Found ${data.analysis_summary.concepts_identified} concepts. Generated ${data.total_questions} questions.`);
                
                // Start quiz
                startQuiz();
                
            } catch (error) {
                showError(error.message);
            } finally {
                processingArea.style.display = 'none';
                analyzeTextBtn.disabled = false;
            }
        });

        // Start quiz
        function startQuiz() {
            if (!quizData) return;
            
            quizSection.style.display = 'block';
            currentQuestion = 0;
            userAnswers = {};
            quizStartTime = Date.now();
            
            // Start timer
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            
            // Initialize quiz
            renderQuestion();
            updateNavigation();
            
            // Scroll to quiz
            quizSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Render question
        function renderQuestion() {
            if (!quizData || !quizData[currentQuestion]) return;
            
            const question = quizData[currentQuestion];
            progressText.textContent = `Question ${currentQuestion + 1} of ${quizData.length}`;
            
            // Calculate progress
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            quizProgress.style.width = `${progress}%`;
            
            // Create question HTML
            const typeClass = question.type === 'conceptual' ? 'conceptual' :
                            question.type === 'application' ? 'application' : 'definition';
            
            const typeIcon = question.type === 'conceptual' ? 'fa-lightbulb' :
                           question.type === 'application' ? 'fa-cogs' : 'fa-brain';
            
            let optionsHTML = '';
            const letters = ['A', 'B', 'C', 'D'];
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[question.id] === index) {
                    optionClass += ' selected';
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}" data-question="${question.id}">
                        <div class="option-letter">${letters[index]}</div>
                        <div class="option-text">${option}</div>
                    </div>
                `;
            });
            
            quizQuestions.innerHTML = `
                <div class="quiz-question">
                    <div class="question-meta">
                        <div class="question-type ${typeClass}">
                            <i class="fas ${typeIcon}"></i> ${question.type.charAt(0).toUpperCase() + question.type.slice(1)} Question
                        </div>
                        <div>
                            <i class="fas fa-bookmark"></i> Source: ${question.source}
                        </div>
                    </div>
                    <div class="question-text">
                        ${question.question}
                    </div>
                    <div class="options-grid">
                        ${optionsHTML}
                    </div>
                </div>
            `;
            
            // Add event listeners to options
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const selectedIndex = parseInt(this.getAttribute('data-index'));
                    const questionId = this.getAttribute('data-question');
                    
                    // Remove selected class from all options in this question
                    document.querySelectorAll(`[data-question="${questionId}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Save answer
                    userAnswers[questionId] = selectedIndex;
                    
                    // Enable submit button if all questions answered
                    const allAnswered = Object.keys(userAnswers).length === quizData.length;
                    submitQuizBtn.style.display = allAnswered ? 'block' : 'none';
                });
            });
        }

        // Navigation
        nextQuestionBtn.addEventListener('click', () => {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateNavigation();
            }
        });

        prevQuestionBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateNavigation();
            }
        });

        function updateNavigation() {
            prevQuestionBtn.disabled = currentQuestion === 0;
            nextQuestionBtn.disabled = currentQuestion === quizData.length - 1;
        }

        // Timer
        function updateTimer() {
            if (!quizStartTime) return;
            
            const now = Date.now();
            const diff = Math.floor((now - quizStartTime) / 1000);
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;
            
            document.getElementById('quizTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Submit quiz
        submitQuizBtn.addEventListener('click', async function() {
            if (!sessionId || !quizData) return;
            
            clearInterval(timerInterval);
            const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
            
            // Prepare answers
            const answers = {};
            for (const [qId, answer] of Object.entries(userAnswers)) {
                answers[qId] = answer;
            }
            
            submitQuizBtn.disabled = true;
            submitQuizBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            
            try {
                const response = await fetch('/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        answers: answers,
                        time_taken: timeTaken
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Submission failed');
                }
                
                // Show results
                showResults(data);
                
            } catch (error) {
                showError(error.message);
            } finally {
                submitQuizBtn.disabled = false;
                submitQuizBtn.innerHTML = '<i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis';
            }
        });

        // Show results
        function showResults(data) {
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';
            
            const profileColors = {
                'conceptual': 'var(--warning)',
                'rote': 'var(--accent)',
                'application': 'var(--success)',
                'inconsistent': 'var(--primary)',
                'balanced': 'var(--primary)'
            };
            
            const profileIcons = {
                'conceptual': 'fa-lightbulb',
                'rote': 'fa-brain',
                'application': 'fa-cogs',
                'inconsistent': 'fa-chart-line',
                'balanced': 'fa-balance-scale'
            };
            
            const profileColor = profileColors[data.learner_profile.type] || 'var(--primary)';
            const profileIcon = profileIcons[data.learner_profile.type] || 'fa-user';
            
            // Create topics HTML
            let topicsHTML = '';
            
            if (data.concept_analysis.strong && data.concept_analysis.strong.length > 0) {
                data.concept_analysis.strong.forEach(concept => {
                    topicsHTML += `
                        <div class="topic-item strong">
                            <div class="topic-header">
                                <strong>${concept}</strong>
                                <span style="font-weight: 700; color: var(--success);">Strong</span>
                            </div>
                            <p style="color: var(--gray); margin-top: 10px;">You understand this concept well</p>
                        </div>
                    `;
                });
            }
            
            if (data.concept_analysis.weak && data.concept_analysis.weak.length > 0) {
                data.concept_analysis.weak.forEach(concept => {
                    topicsHTML += `
                        <div class="topic-item weak">
                            <div class="topic-header">
                                <strong>${concept}</strong>
                                <span style="font-weight: 700; color: var(--danger);">Needs Work</span>
                            </div>
                            <p style="color: var(--gray); margin-top: 10px;">Focus more on this concept</p>
                        </div>
                    `;
                });
            }
            
            // Create study plan HTML
            let studyPlanHTML = '';
            if (data.recommendations.study_plan) {
                data.recommendations.study_plan.forEach((step, index) => {
                    studyPlanHTML += `
                        <div style="padding: 15px; background: white; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: start; gap: 15px;">
                            <div style="width: 30px; height: 30px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">${index + 1}</div>
                            <div>${step}</div>
                        </div>
                    `;
                });
            }
            
            resultsSection.innerHTML = `
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-icon" style="background: linear-gradient(135deg, ${profileColor}, ${profileColor}dd);">
                            <i class="fas ${profileIcon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <h2 style="color: var(--secondary); margin-bottom: 10px;">Your Learning Profile</h2>
                            <h1 style="color: ${profileColor}; margin-bottom: 15px; font-size: 2.5rem;">${data.learner_profile.type.toUpperCase()} LEARNER</h1>
                            <p style="color: var(--gray); line-height: 1.6;">${data.learner_profile.description}</p>
                        </div>
                    </div>
                    
                    <div class="confidence-meter">
                        <div class="meter-label">
                            <span style="font-size: 1.1rem;">Diagnostic Score</span>
                            <strong style="font-size: 1.5rem; color: ${data.quiz_results.accuracy >= 70 ? 'var(--success)' : data.quiz_results.accuracy >= 50 ? 'var(--warning)' : 'var(--danger)'};">${data.quiz_results.accuracy.toFixed(1)}%</strong>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: ${data.quiz_results.accuracy}%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                            <span>${data.quiz_results.correct} correct</span>
                            <span>${data.quiz_results.total} total</span>
                        </div>
                    </div>
                </div>
                
                ${topicsHTML ? `
                <div class="profile-card">
                    <h3 style="color: var(--secondary); margin-bottom: 25px; font-size: 1.5rem;">
                        <i class="fas fa-layer-group"></i> Concept Analysis
                    </h3>
                    <div class="topics-breakdown">
                        ${topicsHTML}
                    </div>
                </div>
                ` : ''}
                
                <div class="profile-card">
                    <h3 style="color: var(--secondary); margin-bottom: 30px; font-size: 1.5rem;">
                        <i class="fas fa-graduation-cap"></i> Personalized Study Plan
                    </h3>
                    
                    <div style="background: linear-gradient(135deg, #f8fbff, #eef2ff); padding: 25px; border-radius: var(--border-radius); margin-bottom: 30px;">
                        <h4 style="color: var(--secondary); margin-bottom: 15px;">Recommended Techniques</h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            ${data.recommendations.recommended_techniques.map(tech => `
                                <div style="padding: 12px 20px; background: white; border-radius: 8px; font-weight: 600; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                                    <i class="fas fa-check-circle"></i> ${tech}
                                </div>
                            `).join('')}
                        </div>
                        <p style="color: var(--gray); margin-top: 15px;">${data.recommendations.why_fits}</p>
                    </div>
                    
                    <h4 style="color: var(--secondary); margin: 25px 0 15px;">Step-by-Step Study Plan</h4>
                    ${studyPlanHTML}
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;"><i class="fas fa-clock"></i> Schedule</h4>
                            <p><strong>Daily:</strong> ${data.recommendations.daily_time}</p>
                            <p><strong>Focus:</strong> ${data.recommendations.focus_ratio}</p>
                        </div>
                        <div style="background: #fff5f5; padding: 20px; border-radius: 10px; border-left: 5px solid var(--danger);">
                            <h4 style="color: var(--danger); margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> Avoid These</h4>
                            <ul style="padding-left: 20px; color: var(--gray);">
                                ${data.recommendations.what_to_avoid.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" id="newDiagnosticBtn" style="padding: 18px 40px;">
                            <i class="fas fa-redo"></i> Start New Diagnostic
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to new diagnostic button
            document.getElementById('newDiagnosticBtn').addEventListener('click', function() {
                location.reload();
            });
            
            // Animate progress bar
            setTimeout(() => {
                const fill = document.querySelector('.meter-fill');
                const width = fill.style.width;
                fill.style.width = '0%';
                setTimeout(() => {
                    fill.style.width = width;
                }, 100);
            }, 300);
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Utility functions
        function showError(message) {
            errorAlert.textContent = message;
            errorAlert.style.display = 'block';
            setTimeout(() => {
                errorAlert.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            successAlert.textContent = message;
            successAlert.style.display = 'block';
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 5000);
        }

        // Initialize
        textInput.dispatchEvent(new Event('input'));
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</body>
</html>
