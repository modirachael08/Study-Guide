<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMind AI | Intelligent Diagnostic Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #f0f5ff 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.2rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--gray);
            margin-bottom: 40px;
        }

        .diagnostic-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .diagnostic-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--secondary);
            font-size: 2rem;
            font-weight: 700;
        }

        .text-input-area {
            margin-bottom: 40px;
        }

        .text-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .word-count.warning {
            color: var(--warning);
        }

        .word-count.error {
            color: var(--danger);
        }

        .text-input-container {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: 250px;
            padding: 25px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: #fdfdfd;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .text-input::placeholder {
            color: var(--gray);
        }

        .text-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .sample-text-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .sample-text-btn:hover {
            color: var(--secondary);
        }

        .processing-area {
            display: none;
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 2px dashed var(--primary-light);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            display: none;
        }

        .quiz-section {
            display: none;
            margin-top: 40px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .progress-container {
            flex: 1;
            margin-right: 30px;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 5px;
        }

        .quiz-question {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .question-type {
            background: var(--gray-light);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .conceptual { background: #e3f2fd; color: #1565c0; }
        .application { background: #e8f5e9; color: #2e7d32; }
        .factual { background: #fff3e0; color: #ef6c00; }
        .critical { background: #f3e5f5; color: #7b1fa2; }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: #f8fbff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: #f0fff4;
        }

        .option.incorrect {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .results-section {
            display: none;
            margin-top: 40px;
        }

        .profile-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px;
            margin-bottom: 25px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .confidence-meter {
            margin-bottom: 30px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .meter-bar {
            height: 12px;
            background: var(--gray-light);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1.5s ease;
            border-radius: 6px;
        }

        .topics-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .topic-item {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .topic-item.strong {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, #f0fff4, #e6ffed);
        }

        .topic-item.weak {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        .study-plan {
            background: linear-gradient(135deg, #f8fbff, #eef2ff);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid var(--accent);
        }

        .technique-recommendation {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .tech-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #ff6b9d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .steps-list {
            list-style: none;
            margin: 20px 0;
        }

        .steps-list li {
            padding: 15px 15px 15px 50px;
            position: relative;
            margin-bottom: 12px;
            background: white;
            border-radius: 8px;
        }

        .steps-list li::before {
            content: '✓';
            position: absolute;
            left: 15px;
            top: 15px;
            width: 24px;
            height: 24px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-large {
            padding: 16px 40px;
            font-size: 1.1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .alert-error {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #2e7d32;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            .diagnostic-container {
                padding: 25px 20px;
            }
            .quiz-header {
                flex-direction: column;
                gap: 15px;
            }
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .technique-recommendation {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>StudyMind AI</span>
            </div>
            <nav>
                <a href="#diagnostic" style="text-decoration: none; color: var(--dark); font-weight: 500;">Diagnostic</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Intelligent Diagnostic Quiz Generator</h1>
            <p>Paste your study material. Get a NotebookLM-style quiz with detailed analysis and personalized study recommendations.</p>
            <button class="btn btn-primary btn-large" id="startBtn">
                <i class="fas fa-play-circle"></i> Start Diagnostic
            </button>
        </div>
    </section>

    <section id="diagnostic" class="container">
        <div class="diagnostic-container">
            <h2 class="section-title">AI Diagnostic Quiz Generator</h2>
            
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <div class="text-input-area">
                <div class="text-input-header">
                    <h3>Paste Your Study Content</h3>
                    <div class="word-count" id="wordCount">0 words (minimum: 100)</div>
                </div>
                
                <div class="text-input-container">
                    <textarea class="text-input" id="textInput" placeholder="Paste your textbook content, lecture notes, or study material here..."></textarea>
                </div>
                
                <div class="text-input-footer">
                    <div>
                        <i class="fas fa-info-circle"></i> Paste at least 100 words for better analysis
                    </div>
                    <button class="sample-text-btn" id="sampleTextBtn">
                        <i class="fas fa-magic"></i> Load Sample Text
                    </button>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary btn-large" id="analyzeTextBtn">
                    <i class="fas fa-bolt"></i> Analyze Text & Generate Quiz
                </button>
            </div>

            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <h3>AI is Analyzing Your Content</h3>
                <p>Extracting key concepts, identifying main topics, and generating diagnostic questions...</p>
            </div>

            <div class="analysis-preview" id="analysisPreview">
                <h3><i class="fas fa-robot"></i> Analysis Complete</h3>
                <div id="analysisDetails"></div>
            </div>

            <div class="quiz-section" id="quizSection">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quizProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray);">
                            <span>Progress</span>
                            <span id="progressText">Question 1 of 10</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--secondary);">Diagnostic Quiz</div>
                        <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">Time: <span id="quizTime">00:00</span></div>
                    </div>
                </div>

                <div id="quizQuestions"></div>

                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                    <button class="btn btn-secondary" id="prevQuestionBtn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-large" id="submitQuizBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis
                    </button>
                </div>
            </div>

            <div class="results-section" id="resultsSection"></div>
        </div>
    </section>

    <script>
        // Advanced Text Analysis Engine
        class AdvancedTextAnalyzer {
            analyzeText(text) {
                if (!text || text.trim().split(/\s+/).length < 50) {
                    throw new Error('Please provide at least 50 words for meaningful analysis.');
                }

                // Clean text
                text = text.replace(/\s+/g, ' ').trim();
                
                const analysis = {
                    concepts: [],
                    topics: [],
                    definitions: [],
                    processes: [],
                    keyTerms: [],
                    relationships: [],
                    sentences: text.split(/[.!?]+/).filter(s => s.trim().length > 10)
                };

                // Extract sentences
                const sentences = analysis.sentences;
                
                // Find definitions (patterns like "X is defined as", "X refers to")
                sentences.forEach(sentence => {
                    const lower = sentence.toLowerCase();
                    
                    // Extract definitions
                    if (lower.includes(' is ') && (lower.includes('defined as') || 
                        lower.includes('refers to') || lower.includes('known as'))) {
                        const words = sentence.split(' ');
                        if (words.length > 3) {
                            const concept = words[0];
                            const definition = sentence.substring(sentence.indexOf(' is ') + 4);
                            analysis.definitions.push({
                                concept: concept,
                                definition: definition,
                                sentence: sentence
                            });
                            if (!analysis.concepts.includes(concept)) {
                                analysis.concepts.push(concept);
                            }
                        }
                    }

                    // Find processes (steps, stages, phases)
                    if (lower.includes('process') || lower.includes('steps') || 
                        lower.includes('stages') || lower.includes('phases')) {
                        analysis.processes.push(sentence);
                    }

                    // Find key terms (capitalized nouns that are important)
                    const capitalized = sentence.match(/\b[A-Z][a-z]+\b(?: [A-Z][a-z]+\b)*/g) || [];
                    capitalized.forEach(term => {
                        if (term.split(' ').length <= 3 && 
                            !['The', 'This', 'That', 'These', 'Those'].includes(term)) {
                            if (!analysis.keyTerms.includes(term)) {
                                analysis.keyTerms.push(term);
                            }
                            if (!analysis.concepts.includes(term)) {
                                analysis.concepts.push(term);
                            }
                        }
                    });
                });

                // Extract topics from headings
                const lines = text.split('\n');
                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (trimmed.length < 100 && 
                        (trimmed.endsWith(':') || 
                         trimmed.split(' ').length <= 6 ||
                         /^[A-Z][^a-z]*$/.test(trimmed) ||
                         /^\d+\./.test(trimmed))) {
                        const topic = trimmed.replace(/[:•\-]/g, '').trim();
                        if (topic.length > 2 && !analysis.topics.includes(topic)) {
                            analysis.topics.push(topic);
                        }
                    }
                });

                // If no topics found, use key terms
                if (analysis.topics.length === 0 && analysis.keyTerms.length > 0) {
                    analysis.topics = analysis.keyTerms.slice(0, 5);
                }

                // Find relationships between concepts
                sentences.forEach(sentence => {
                    if (sentence.includes(' and ') || sentence.includes(' or ') || 
                        sentence.includes(' versus ') || sentence.includes(' vs ')) {
                        analysis.relationships.push(sentence);
                    }
                });

                return analysis;
            }

            generateQuestions(analysis, count = 10) {
                const questions = [];
                const concepts = [...new Set([...analysis.concepts, ...analysis.keyTerms])].slice(0, 15);
                
                if (concepts.length < 3) {
                    throw new Error('Not enough concepts found in text. Please provide more detailed content.');
                }

                // Question templates with specific contexts
                const templates = {
                    conceptual: [
                        "According to the text, what is the primary function or purpose of {concept}?",
                        "Based on the description, how does {concept} differ from similar ideas mentioned?",
                        "What key characteristic makes {concept} unique according to the text?",
                        "Why is understanding {concept} important in the context described?"
                    ],
                    application: [
                        "If you were to apply {concept} to solve a problem mentioned in the text, what approach would you take?",
                        "Based on the information provided, what would be a practical scenario where {concept} would be useful?",
                        "How would you use your understanding of {concept} to address a situation described?",
                        "What specific action would demonstrate proper application of {concept} as described?"
                    ],
                    factual: [
                        "Which of these facts about {concept} is explicitly stated in the text?",
                        "According to the text, where does {concept} typically occur or take place?",
                        "What specific example of {concept} is provided in the material?",
                        "Which detail about {concept} is directly mentioned?"
                    ],
                    critical: [
                        "What would be the most significant consequence if {concept} was misunderstood or misapplied?",
                        "How does {concept} influence or relate to other elements mentioned in the text?",
                        "Based on the text, what assumption underlies the concept of {concept}?",
                        "What can be inferred about the limitations of {concept} from the information provided?"
                    ]
                };

                // Generate questions with specific content from text
                for (let i = 0; i < count && i < concepts.length; i++) {
                    const concept = concepts[i];
                    const type = i < 4 ? 'conceptual' : i < 7 ? 'application' : i < 9 ? 'factual' : 'critical';
                    const template = templates[type][i % templates[type].length];
                    
                    // Find relevant context for this concept
                    let context = '';
                    for (const sentence of analysis.sentences) {
                        if (sentence.includes(concept)) {
                            context = sentence;
                            break;
                        }
                    }
                    
                    // Generate question with specific answer based on text
                    const questionText = template.replace('{concept}', concept);
                    
                    // Generate specific options based on actual text content
                    const { options, correctIndex, explanation } = this.generateSpecificOptions(concept, type, analysis, context);
                    
                    questions.push({
                        id: i + 1,
                        type: type,
                        concept: concept,
                        text: questionText,
                        options: options,
                        correctAnswer: correctIndex,
                        explanation: explanation,
                        source: context.substring(0, 100) + '...' || 'General content'
                    });
                }

                return questions;
            }

            generateSpecificOptions(concept, type, analysis, context) {
                // Find correct answer from text
                let correctAnswer = '';
                let explanation = '';
                
                // Look for definition
                const definition = analysis.definitions.find(d => d.concept === concept);
                if (definition) {
                    correctAnswer = definition.definition;
                    explanation = `The text explicitly states: "${definition.definition}"`;
                } else {
                    // Look for sentences containing the concept
                    const relevantSentences = analysis.sentences.filter(s => 
                        s.includes(concept) && s.length > 20
                    );
                    
                    if (relevantSentences.length > 0) {
                        const sentence = relevantSentences[0];
                        // Extract key information
                        const words = sentence.split(' ');
                        const index = words.findIndex(w => w.includes(concept));
                        if (index !== -1) {
                            const start = Math.max(0, index - 5);
                            const end = Math.min(words.length, index + 10);
                            correctAnswer = words.slice(start, end).join(' ');
                            explanation = `This is based on the text: "${sentence.substring(0, 150)}..."`;
                        }
                    }
                }

                // If no specific info found, create logical answer
                if (!correctAnswer) {
                    switch(type) {
                        case 'conceptual':
                            correctAnswer = `It serves a key role as described in the text about ${concept}`;
                            break;
                        case 'application':
                            correctAnswer = `It can be applied in situations mentioned in the text involving ${concept}`;
                            break;
                        case 'factual':
                            correctAnswer = `This fact about ${concept} is directly stated in the material`;
                            break;
                        default:
                            correctAnswer = `This reflects the critical understanding of ${concept} from the text`;
                    }
                    explanation = `This answer correctly interprets the information about ${concept} provided in the text`;
                }

                // Generate distractors based on common misconceptions
                const distractors = [
                    `This describes a different concept entirely, not ${concept}`,
                    `This contradicts the information provided about ${concept}`,
                    `While related, this is actually about a broader or narrower scope than ${concept}`,
                    `This is a common misconception not supported by the text`,
                    `This oversimplifies the complexity of ${concept} described`,
                    `This confuses ${concept} with another idea mentioned in the text`
                ];

                // Shuffle and select 3 distractors
                const shuffled = [...distractors].sort(() => Math.random() - 0.5);
                const selectedDistractors = shuffled.slice(0, 3);
                
                // Combine and shuffle all options
                const allOptions = [correctAnswer, ...selectedDistractors];
                const shuffledOptions = this.shuffleArray(allOptions);
                const correctIndex = shuffledOptions.indexOf(correctAnswer);

                return {
                    options: shuffledOptions,
                    correctIndex: correctIndex,
                    explanation: explanation
                };
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            analyzePerformance(questions, answers) {
                const results = {
                    total: questions.length,
                    correct: 0,
                    accuracy: 0,
                    conceptPerformance: {},
                    typePerformance: {
                        conceptual: { correct: 0, total: 0 },
                        application: { correct: 0, total: 0 },
                        factual: { correct: 0, total: 0 },
                        critical: { correct: 0, total: 0 }
                    },
                    responsePatterns: []
                };

                // Calculate scores
                questions.forEach((question, index) => {
                    const qid = (index + 1).toString();
                    const isCorrect = answers[qid] === question.correctAnswer;
                    
                    if (isCorrect) results.correct++;
                    
                    // Track concept performance
                    if (!results.conceptPerformance[question.concept]) {
                        results.conceptPerformance[question.concept] = { correct: 0, total: 0 };
                    }
                    results.conceptPerformance[question.concept].total++;
                    if (isCorrect) results.conceptPerformance[question.concept].correct++;
                    
                    // Track type performance
                    results.typePerformance[question.type].total++;
                    if (isCorrect) results.typePerformance[question.type].correct++;
                });

                results.accuracy = (results.correct / results.total) * 100;
                
                return results;
            }

            generateLearningProfile(performance) {
                const typeScores = {};
                for (const [type, data] of Object.entries(performance.typePerformance)) {
                    if (data.total > 0) {
                        typeScores[type] = (data.correct / data.total) * 100;
                    }
                }

                // Analyze learning patterns
                const conceptualScore = typeScores.conceptual || 0;
                const factualScore = typeScores.factual || 0;
                const applicationScore = typeScores.application || 0;
                const criticalScore = typeScores.critical || 0;

                let profile = {
                    type: 'Balanced Learner',
                    description: 'You show balanced understanding across different question types.',
                    icon: 'fa-balance-scale',
                    color: '#4361ee',
                    strengths: [],
                    weaknesses: []
                };

                // Determine primary learning style
                if (conceptualScore >= 80 && factualScore < 60) {
                    profile.type = 'Conceptual Thinker';
                    profile.description = 'You excel at understanding underlying principles and making connections between ideas.';
                    profile.icon = 'fa-lightbulb';
                    profile.color = '#f8961e';
                    profile.strengths.push('Conceptual understanding', 'Making connections');
                    profile.weaknesses.push('Memorizing facts', 'Recalling details');
                } else if (factualScore >= 80 && applicationScore < 60) {
                    profile.type = 'Detail-Oriented Learner';
                    profile.description = 'You are strong at remembering specific facts and details from the material.';
                    profile.icon = 'fa-brain';
                    profile.color = '#f72585';
                    profile.strengths.push('Fact recall', 'Attention to detail');
                    profile.weaknesses.push('Practical application', 'Critical thinking');
                } else if (applicationScore >= 80 && conceptualScore < 60) {
                    profile.type = 'Practical Application Learner';
                    profile.description = 'You learn best by applying knowledge to real-world situations and solving problems.';
                    profile.icon = 'fa-cogs';
                    profile.color = '#4cc9f0';
                    profile.strengths.push('Problem-solving', 'Practical application');
                    profile.weaknesses.push('Theoretical understanding', 'Abstract thinking');
                } else if (criticalScore >= 80) {
                    profile.type = 'Critical Thinker';
                    profile.description = 'You excel at analyzing information critically and making inferences.';
                    profile.icon = 'fa-search';
                    profile.color = '#9d4edd';
                    profile.strengths.push('Critical analysis', 'Making inferences');
                }

                return profile;
            }

            generateStudyPlan(profile, performance, questions) {
                // Identify strong and weak concepts
                const strongConcepts = [];
                const weakConcepts = [];
                
                for (const [concept, data] of Object.entries(performance.conceptPerformance)) {
                    const accuracy = (data.correct / data.total) * 100;
                    if (accuracy >= 80) {
                        strongConcepts.push(concept);
                    } else if (accuracy <= 50) {
                        weakConcepts.push(concept);
                    }
                }

                // Recommended techniques based on profile
                const techniqueMap = {
                    'Conceptual Thinker': ['Feynman Technique', 'Concept Mapping', 'Teaching Others'],
                    'Detail-Oriented Learner': ['Spaced Repetition', 'Active Recall', 'Flashcards'],
                    'Practical Application Learner': ['Practice Problems', 'Case Studies', 'Real-world Projects'],
                    'Critical Thinker': ['Socratic Questioning', 'Debate Practice', 'Analysis Exercises'],
                    'Balanced Learner': ['Interleaving', 'Mixed Practice', 'Self-testing']
                };

                const techniques = techniqueMap[profile.type] || techniqueMap['Balanced Learner'];

                // Generate study plan
                const studyPlan = [];
                
                if (weakConcepts.length > 0) {
                    studyPlan.push(`Focus primarily on: ${weakConcepts.slice(0, 3).join(', ')}`);
                }
                
                studyPlan.push(`Use ${techniques[0]} to strengthen ${profile.weaknesses.length > 0 ? profile.weaknesses[0] : 'your understanding'}`);
                studyPlan.push('Create summary notes explaining concepts in your own words');
                studyPlan.push('Test yourself regularly using different question types');
                
                if (strongConcepts.length > 0) {
                    studyPlan.push(`Review strong concepts periodically: ${strongConcepts.slice(0, 3).join(', ')}`);
                }
                
                studyPlan.push('Connect new information to what you already know');
                studyPlan.push('Practice explaining concepts to someone else');

                return {
                    techniques: techniques,
                    studyPlan: studyPlan,
                    strongConcepts: strongConcepts.slice(0, 5),
                    weakConcepts: weakConcepts.slice(0, 5),
                    dailyTime: '45-60 minutes',
                    focusRatio: '60% weak topics, 30% medium, 10% strong',
                    avoid: [
                        'Passive reading without active engagement',
                        'Cramming all studying into one session',
                        'Only reviewing comfortable topics',
                        'Studying without specific goals'
                    ]
                };
            }
        }

        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            const analyzer = new AdvancedTextAnalyzer();
            let currentQuestions = [];
            let userAnswers = {};
            let quizStartTime = null;
            let timerInterval = null;
            let currentQuestion = 0;

            // DOM Elements
            const elements = {
                textInput: document.getElementById('textInput'),
                wordCount: document.getElementById('wordCount'),
                analyzeBtn: document.getElementById('analyzeTextBtn'),
                processing: document.getElementById('processingArea'),
                analysisPreview: document.getElementById('analysisPreview'),
                analysisDetails: document.getElementById('analysisDetails'),
                quizSection: document.getElementById('quizSection'),
                quizQuestions: document.getElementById('quizQuestions'),
                progressText: document.getElementById('progressText'),
                quizProgress: document.getElementById('quizProgress'),
                prevBtn: document.getElementById('prevQuestionBtn'),
                nextBtn: document.getElementById('nextQuestionBtn'),
                submitBtn: document.getElementById('submitQuizBtn'),
                resultsSection: document.getElementById('resultsSection'),
                errorAlert: document.getElementById('errorAlert'),
                successAlert: document.getElementById('successAlert')
            };

            // Word count tracking
            elements.textInput.addEventListener('input', function() {
                const text = this.value.trim();
                const words = text === '' ? 0 : text.split(/\s+/).length;
                elements.wordCount.textContent = `${words} words (minimum: 100)`;
                
                if (words >= 100) {
                    elements.wordCount.className = 'word-count';
                    elements.analyzeBtn.disabled = false;
                } else if (words >= 50) {
                    elements.wordCount.className = 'word-count warning';
                    elements.analyzeBtn.disabled = true;
                } else {
                    elements.wordCount.className = 'word-count error';
                    elements.analyzeBtn.disabled = true;
                }
            });

            // Load sample text
            document.getElementById('sampleTextBtn').addEventListener('click', function() {
                const sampleText = `Photosynthesis: The Energy Conversion Process

Definition: Photosynthesis is the biochemical process by which plants, algae, and some bacteria convert light energy into chemical energy stored in glucose.

Key Stages:
1. Light-dependent reactions occur in the thylakoid membranes of chloroplasts. Chlorophyll absorbs light energy, which splits water molecules into oxygen, protons, and electrons. This stage produces ATP and NADPH as energy carriers.

2. Calvin cycle (light-independent reactions) takes place in the stroma of chloroplasts. Here, carbon dioxide is fixed and converted into glucose using the ATP and NADPH produced in the light reactions. The enzyme RuBisCO catalyzes carbon fixation.

Importance: Photosynthesis is fundamental to life on Earth because it produces oxygen and forms the base of most food chains. The overall chemical equation is: 6CO₂ + 6H₂O + light energy → C₆H₁₂O₆ + 6O₂.

Factors Affecting Rate:
- Light intensity: Higher intensity increases rate until saturation
- Carbon dioxide concentration: Limited by atmospheric levels
- Temperature: Optimal around 25°C for most plants
- Water availability: Essential for the light reactions

Adaptations: Some plants like cacti use CAM photosynthesis to minimize water loss, opening stomata at night to take in CO₂ and storing it for daytime use.

Comparison with Cellular Respiration: While photosynthesis stores energy by building glucose, cellular respiration releases energy by breaking it down. These processes form a complementary cycle in ecosystems.`;
                
                elements.textInput.value = sampleText;
                elements.textInput.dispatchEvent(new Event('input'));
            });

            // Start diagnostic
            document.getElementById('startBtn').addEventListener('click', function() {
                document.getElementById('diagnostic').scrollIntoView({ behavior: 'smooth' });
                elements.textInput.focus();
            });

            // Analyze text and generate quiz
            elements.analyzeBtn.addEventListener('click', function() {
                const text = elements.textInput.value.trim();
                
                if (text.split(/\s+/).length < 50) {
                    showError('Please enter at least 50 words for meaningful analysis.');
                    return;
                }
                
                // Show processing
                elements.processing.style.display = 'block';
                elements.analyzeBtn.disabled = true;
                
                // Process in background to prevent UI freeze
                setTimeout(() => {
                    try {
                        // Analyze text
                        const analysis = analyzer.analyzeText(text);
                        
                        // Generate questions
                        currentQuestions = analyzer.generateQuestions(analysis, 10);
                        
                        // Show analysis preview
                        elements.analysisDetails.innerHTML = `
                            <p><i class="fas fa-check-circle"></i> Found ${analysis.concepts.length} key concepts</p>
                            <p><i class="fas fa-tags"></i> Identified ${analysis.topics.length} main topics</p>
                            <p><i class="fas fa-question-circle"></i> Generated ${currentQuestions.length} diagnostic questions</p>
                            <p><i class="fas fa-lightbulb"></i> Question types: Conceptual, Application, Factual, Critical</p>
                        `;
                        elements.analysisPreview.style.display = 'block';
                        
                        showSuccess('Analysis complete! Ready to generate quiz.');
                        
                        // Start quiz after delay
                        setTimeout(() => startQuiz(), 1000);
                        
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        elements.processing.style.display = 'none';
                        elements.analyzeBtn.disabled = false;
                    }
                }, 1500);
            });

            // Start quiz
            function startQuiz() {
                if (!currentQuestions || currentQuestions.length === 0) return;
                
                elements.quizSection.style.display = 'block';
                currentQuestion = 0;
                userAnswers = {};
                quizStartTime = Date.now();
                
                // Start timer
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
                
                // Render first question
                renderQuestion();
                updateNavigation();
                
                // Scroll to quiz
                elements.quizSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Render question
            function renderQuestion() {
                if (!currentQuestions || !currentQuestions[currentQuestion]) return;
                
                const question = currentQuestions[currentQuestion];
                elements.progressText.textContent = `Question ${currentQuestion + 1} of ${currentQuestions.length}`;
                
                // Update progress
                const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
                elements.quizProgress.style.width = `${progress}%`;
                
                // Get question type styling
                const typeClass = question.type;
                const typeIcon = {
                    conceptual: 'fa-lightbulb',
                    application: 'fa-cogs',
                    factual: 'fa-brain',
                    critical: 'fa-search'
                }[question.type] || 'fa-question';
                
                // Generate options HTML
                let optionsHTML = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                question.options.forEach((option, index) => {
                    let optionClass = 'option';
                    const qid = question.id.toString();
                    if (userAnswers[qid] === index) {
                        optionClass += ' selected';
                    }
                    
                    optionsHTML += `
                        <div class="${optionClass}" data-index="${index}" data-question="${qid}">
                            <div class="option-letter">${letters[index]}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                });
                
                // Build question HTML
                elements.quizQuestions.innerHTML = `
                    <div class="quiz-question">
                        <div class="question-meta">
                            <div class="question-type ${typeClass}">
                                <i class="fas ${typeIcon}"></i> ${question.type.charAt(0).toUpperCase() + question.type.slice(1)}
                            </div>
                            <div>
                                <i class="fas fa-tag"></i> ${question.concept}
                            </div>
                        </div>
                        <div class="question-text">
                            ${question.text}
                        </div>
                        <div class="options-grid">
                            ${optionsHTML}
                        </div>
                    </div>
                `;
                
                // Add event listeners to options
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        const questionId = this.getAttribute('data-question');
                        
                        // Remove selection from all options
                        document.querySelectorAll(`[data-question="${questionId}"]`).forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Add selection to clicked option
                        this.classList.add('selected');
                        
                        // Save answer
                        userAnswers[questionId] = selectedIndex;
                        
                        // Enable submit if all questions answered
                        const allAnswered = Object.keys(userAnswers).length === currentQuestions.length;
                        elements.submitBtn.style.display = allAnswered ? 'block' : 'none';
                    });
                });
            }

            // Navigation
            elements.nextBtn.addEventListener('click', () => {
                if (currentQuestion < currentQuestions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                    updateNavigation();
                }
            });

            elements.prevBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    updateNavigation();
                }
            });

            function updateNavigation() {
                elements.prevBtn.disabled = currentQuestion === 0;
                elements.nextBtn.disabled = currentQuestion === currentQuestions.length - 1;
            }

            // Timer
            function updateTimer() {
                if (!quizStartTime) return;
                
                const now = Date.now();
                const diff = Math.floor((now - quizStartTime) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                
                document.getElementById('quizTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Submit quiz
            elements.submitBtn.addEventListener('click', function() {
                clearInterval(timerInterval);
                const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
                
                elements.submitBtn.disabled = true;
                elements.submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
                
                // Analyze performance
                setTimeout(() => {
                    try {
                        const performance = analyzer.analyzePerformance(currentQuestions, userAnswers);
                        const profile = analyzer.generateLearningProfile(performance);
                        const studyPlan = analyzer.generateStudyPlan(profile, performance, currentQuestions);
                        
                        showResults(performance, profile, studyPlan, timeTaken);
                        
                    } catch (error) {
                        showError('Error analyzing results: ' + error.message);
                    } finally {
                        elements.submitBtn.disabled = false;
                        elements.submitBtn.innerHTML = '<i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis';
                    }
                }, 1500);
            });

            // Show results
            function showResults(performance, profile, studyPlan, timeTaken) {
                elements.quizSection.style.display = 'none';
                elements.resultsSection.style.display = 'block';
                
                // Create topics breakdown
                let topicsHTML = '';
                
                if (studyPlan.strongConcepts.length > 0) {
                    studyPlan.strongConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item strong">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--success);">Strong</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">You show excellent understanding of this concept</p>
                            </div>
                        `;
                    });
                }
                
                if (studyPlan.weakConcepts.length > 0) {
                    studyPlan.weakConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item weak">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--danger);">Needs Focus</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">Spend more time on this area</p>
                            </div>
                        `;
                    });
                }
                
                // Create study plan steps
                let studyPlanHTML = '';
                studyPlan.studyPlan.forEach((step, index) => {
                    studyPlanHTML += `<li>${step}</li>`;
                });
                
                // Build results HTML
                elements.resultsSection.innerHTML = `
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-icon" style="background: linear-gradient(135deg, ${profile.color}, ${profile.color}dd);">
                                <i class="fas ${profile.icon}"></i>
                            </div>
                            <div style="flex: 1;">
                                <h2 style="color: var(--secondary); margin-bottom: 10px;">Diagnostic Results</h2>
                                <h3 style="color: ${profile.color}; margin-bottom: 10px;">${profile.type}</h3>
                                <p style="color: var(--gray); line-height: 1.6;">${profile.description}</p>
                                ${profile.strengths.length > 0 ? `<p style="margin-top: 10px;"><strong>Strengths:</strong> ${profile.strengths.join(', ')}</p>` : ''}
                                ${profile.weaknesses.length > 0 ? `<p><strong>Areas to improve:</strong> ${profile.weaknesses.join(', ')}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="confidence-meter">
                            <div class="meter-label">
                                <span style="font-size: 1.1rem;">Overall Score</span>
                                <strong style="font-size: 1.5rem; color: ${performance.accuracy >= 70 ? 'var(--success)' : performance.accuracy >= 50 ? 'var(--warning)' : 'var(--danger)'};">${performance.accuracy.toFixed(1)}%</strong>
                            </div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: ${performance.accuracy}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                                <span>${performance.correct} / ${performance.total} correct</span>
                                <span>Time: ${Math.floor(timeTaken/60)}:${(timeTaken%60).toString().padStart(2, '0')}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${topicsHTML ? `
                    <div class="profile-card">
                        <h3 style="color: var(--secondary); margin-bottom: 20px;">
                            <i class="fas fa-chart-bar"></i> Concept Performance
                        </h3>
                        <div class="topics-breakdown">
                            ${topicsHTML}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="study-plan">
                        <div class="technique-recommendation">
                            <div class="tech-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--secondary); margin-bottom: 10px;">Personalized Study Plan</h3>
                                <p style="color: var(--gray);">Recommended techniques: <strong>${studyPlan.techniques.join(', ')}</strong></p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--secondary); margin: 20px 0 15px;">Action Steps:</h4>
                        <ol class="steps-list">
                            ${studyPlanHTML}
                        </ol>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 25px 0;">
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--secondary); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-clock"></i> Schedule</h4>
                                <p style="font-size: 0.9rem; color: var(--gray);">${studyPlan.dailyTime} daily</p>
                                <p style="font-size: 0.9rem; color: var(--gray);">Focus: ${studyPlan.focusRatio}</p>
                            </div>
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--danger); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> Avoid These</h4>
                                <ul style="padding-left: 20px; font-size: 0.9rem; color: var(--gray);">
                                    ${studyPlan.avoid.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn btn-primary" id="newDiagnosticBtn">
                                <i class="fas fa-redo"></i> Start New Diagnostic
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listener for new diagnostic
                document.getElementById('newDiagnosticBtn').addEventListener('click', function() {
                    location.reload();
                });
                
                // Animate progress bar
                setTimeout(() => {
                    const fill = document.querySelector('.meter-fill');
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                }, 300);
                
                // Scroll to results
                elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Utility functions
            function showError(message) {
                elements.errorAlert.textContent = message;
                elements.errorAlert.style.display = 'block';
                setTimeout(() => {
                    elements.errorAlert.style.display = 'none';
                }, 5000);
            }

            function showSuccess(message) {
                elements.successAlert.textContent = message;
                elements.successAlert.style.display = 'block';
                setTimeout(() => {
                    elements.successAlert.style.display = 'none';
                }, 5000);
            }

            // Initialize
            elements.textInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
