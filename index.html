<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMind AI | NotebookLM-Style Quiz Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #f0f5ff 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 40px;
        }

        .diagnostic-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .diagnostic-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--secondary);
            font-size: 2rem;
            font-weight: 700;
        }

        .text-input-area {
            margin-bottom: 40px;
        }

        .text-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .word-count.warning {
            color: var(--warning);
        }

        .word-count.error {
            color: var(--danger);
        }

        .text-input-container {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: 350px;
            padding: 25px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: #fdfdfd;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .text-input::placeholder {
            color: var(--gray);
        }

        .text-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .sample-text-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .sample-text-btn:hover {
            color: var(--secondary);
        }

        .quality-indicator {
            margin: 15px 0;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .quality-good {
            color: var(--success);
            background: #e8f5e9;
        }

        .quality-poor {
            color: var(--warning);
            background: #fff3e0;
        }

        .processing-area {
            display: none;
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 2px dashed var(--primary-light);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            display: none;
        }

        .quiz-section {
            display: none;
            margin-top: 40px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .progress-container {
            flex: 1;
            margin-right: 30px;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 5px;
        }

        .quiz-question {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .question-type {
            background: var(--gray-light);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .conceptual { background: #e3f2fd; color: #1565c0; }
        .application { background: #e8f5e9; color: #2e7d32; }
        .analytical { background: #fff3e0; color: #ef6c00; }
        .synthesis { background: #f3e5f5; color: #7b1fa2; }

        .question-text {
            font-size: 1.25rem;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: #f8fbff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: #f0fff4;
        }

        .option.incorrect {
            border-color: var(--danger);
            background: #fff5f5;
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option-content {
            flex: 1;
        }

        .option-explanation {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
            display: none;
        }

        .show-explanation .option-explanation {
            display: block;
        }

        .results-section {
            display: none;
            margin-top: 40px;
        }

        .profile-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px;
            margin-bottom: 25px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .confidence-meter {
            margin-bottom: 30px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .meter-bar {
            height: 12px;
            background: var(--gray-light);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1.5s ease;
            border-radius: 6px;
        }

        .topics-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .topic-item {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .topic-item.strong {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, #f0fff4, #e6ffed);
        }

        .topic-item.weak {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        .study-plan {
            background: linear-gradient(135deg, #f8fbff, #eef2ff);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid var(--accent);
        }

        .technique-recommendation {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .tech-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #ff6b9d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .steps-list {
            list-style: none;
            margin: 20px 0;
        }

        .steps-list li {
            padding: 15px 15px 15px 50px;
            position: relative;
            margin-bottom: 12px;
            background: white;
            border-radius: 8px;
        }

        .steps-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 15px;
            top: 15px;
            width: 24px;
            height: 24px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-large {
            padding: 16px 40px;
            font-size: 1.1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .alert-error {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #2e7d32;
        }

        .insight-box {
            background: linear-gradient(135deg, #f0f4ff, #e6eeff);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .learning-level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .level-beginner { background: #e3f2fd; color: #1565c0; }
        .level-intermediate { background: #e8f5e9; color: #2e7d32; }
        .level-advanced { background: #fff3e0; color: #ef6c00; }
        .level-expert { background: #f3e5f5; color: #7b1fa2; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2.3rem; }
            .diagnostic-container { padding: 25px 20px; }
            .quiz-header { flex-direction: column; gap: 15px; }
            .profile-header { flex-direction: column; text-align: center; gap: 15px; }
            .technique-recommendation { flex-direction: column; text-align: center; gap: 15px; }
            .btn { width: 100%; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>StudyMind AI</span>
            </div>
            <nav>
                <a href="#diagnostic" style="text-decoration: none; color: var(--dark); font-weight: 500;">Diagnostic</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1>Intelligent Learning Diagnostic</h1>
            <p>Paste your study material. Get NotebookLM-style quizzes with deep learning analytics and personalized study plans.</p>
            <button class="btn btn-primary btn-large" id="startBtn">
                <i class="fas fa-play-circle"></i> Start Diagnostic
            </button>
        </div>
    </section>

    <section id="diagnostic" class="container">
        <div class="diagnostic-container">
            <h2 class="section-title">Advanced Text Analysis & Quiz Generation</h2>
            
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <div class="text-input-area">
                <div class="text-input-header">
                    <h3>Paste Your Study Content</h3>
                    <div class="word-count" id="wordCount">0 words (minimum: 200)</div>
                </div>
                
                <div class="text-input-container">
                    <textarea class="text-input" id="textInput" placeholder="Paste your textbook content, lecture notes, or study material here..."></textarea>
                </div>
                
                <div class="quality-indicator" id="qualityIndicator">
                    <i class="fas fa-info-circle"></i> Tip: Include definitions, examples, and explanations for better analysis
                </div>
                
                <div class="text-input-footer">
                    <div>
                        <i class="fas fa-lightbulb"></i> More detailed content = Better analysis
                    </div>
                    <button class="sample-text-btn" id="sampleTextBtn">
                        <i class="fas fa-magic"></i> Load Sample Text
                    </button>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary btn-large" id="analyzeTextBtn">
                    <i class="fas fa-bolt"></i> Analyze & Generate Quiz
                </button>
            </div>

            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <h3>AI is Analyzing Your Content</h3>
                <p>Extracting concepts, understanding relationships, and creating insightful questions...</p>
            </div>

            <div class="analysis-preview" id="analysisPreview">
                <h3><i class="fas fa-robot"></i> Analysis Complete</h3>
                <div id="analysisDetails"></div>
            </div>

            <div class="quiz-section" id="quizSection">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quizProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray);">
                            <span>Progress</span>
                            <span id="progressText">Question 1 of 10</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--secondary);">Insightful Quiz</div>
                        <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">Time: <span id="quizTime">00:00</span></div>
                    </div>
                </div>

                <div id="quizQuestions"></div>

                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                    <button class="btn btn-secondary" id="prevQuestionBtn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-large" id="submitQuizBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> Submit & Get Deep Analysis
                    </button>
                </div>
            </div>

            <div class="results-section" id="resultsSection"></div>
        </div>
    </section>

    <script>
        // Advanced Quiz Generation Engine - NotebookLM Style
        class NotebookLMStyleEngine {
            constructor() {
                this.analysisCache = {};
                this.learningPatterns = new Map();
            }

            analyzeContentQuality(text) {
                const words = text.split(/\s+/).length;
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10).length;
                const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 0).length;
                
                let score = 0;
                let feedback = [];
                
                // Quality metrics
                if (words >= 300) score += 30;
                else if (words >= 150) score += 20;
                else if (words >= 100) score += 10;
                
                if (sentences >= 15) score += 20;
                else if (sentences >= 10) score += 15;
                else if (sentences >= 5) score += 10;
                
                // Check for definitions
                const definitionPatterns = [
                    /is defined as/i,
                    /refers to/i,
                    /means that/i,
                    /known as/i,
                    /called/i
                ];
                
                let definitionCount = 0;
                definitionPatterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) definitionCount += matches.length;
                });
                
                if (definitionCount >= 3) {
                    score += 20;
                    feedback.push('Good: Contains clear definitions');
                } else if (definitionCount >= 1) {
                    score += 10;
                    feedback.push('Okay: Some definitions present');
                }
                
                // Check for examples
                const examplePatterns = [
                    /for example/i,
                    /such as/i,
                    /e\.g\./i,
                    /including/i,
                    /like/i
                ];
                
                let exampleCount = 0;
                examplePatterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) exampleCount += matches.length;
                });
                
                if (exampleCount >= 2) {
                    score += 15;
                    feedback.push('Good: Includes examples');
                }
                
                // Check for explanations
                const explanationPatterns = [
                    /because/i,
                    /therefore/i,
                    /thus/i,
                    /so/i,
                    /which means/i
                ];
                
                let explanationCount = 0;
                explanationPatterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) explanationCount += matches.length;
                });
                
                if (explanationCount >= 2) {
                    score += 15;
                    feedback.push('Good: Contains explanations');
                }
                
                // Overall quality assessment
                let quality;
                if (score >= 70) {
                    quality = 'Excellent - Will generate insightful questions';
                } else if (score >= 50) {
                    quality = 'Good - Should generate meaningful questions';
                } else if (score >= 30) {
                    quality = 'Fair - Questions may be basic';
                } else {
                    quality = 'Poor - Add more details for better analysis';
                }
                
                return {
                    score,
                    quality,
                    feedback,
                    metrics: { words, sentences, paragraphs, definitionCount, exampleCount, explanationCount }
                };
            }

            extractCoreInsights(text) {
                // Advanced text processing for NotebookLM-style understanding
                const insights = {
                    keyConcepts: [],
                    relationships: [],
                    hierarchies: [],
                    processes: [],
                    examples: [],
                    implications: [],
                    knowledgeLevel: 'intermediate'
                };

                // Extract sentences and clean text
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
                const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 0);
                
                // Extract key concepts using multiple methods
                const concepts = new Set();
                
                // Method 1: Look for definitions
                sentences.forEach(sentence => {
                    const lower = sentence.toLowerCase();
                    if (lower.includes(' is ') || lower.includes(' defined as ') || lower.includes(' refers to ')) {
                        const words = sentence.split(' ');
                        const isIndex = words.findIndex(w => w.toLowerCase() === 'is');
                        if (isIndex > 0 && isIndex < words.length - 2) {
                            const concept = words.slice(0, isIndex).join(' ');
                            if (concept.split(' ').length <= 4) {
                                concepts.add(concept);
                                insights.keyConcepts.push({
                                    concept,
                                    type: 'definition',
                                    sentence: sentence.trim()
                                });
                            }
                        }
                    }
                });

                // Method 2: Look for important terms (capitalized, repeated)
                const words = text.split(/\s+/);
                const wordFrequency = {};
                words.forEach(word => {
                    const cleanWord = word.replace(/[^a-zA-Z]/g, '').toLowerCase();
                    if (cleanWord.length > 4 && !this.isCommonWord(cleanWord)) {
                        wordFrequency[cleanWord] = (wordFrequency[cleanWord] || 0) + 1;
                    }
                });

                // Add frequently mentioned words as concepts
                Object.entries(wordFrequency)
                    .filter(([_, count]) => count >= 2)
                    .slice(0, 10)
                    .forEach(([word]) => {
                        const capitalized = word.charAt(0).toUpperCase() + word.slice(1);
                        if (!concepts.has(capitalized)) {
                            concepts.add(capitalized);
                            insights.keyConcepts.push({
                                concept: capitalized,
                                type: 'key_term',
                                frequency: wordFrequency[word]
                            });
                        }
                    });

                // Extract relationships
                sentences.forEach(sentence => {
                    const lower = sentence.toLowerCase();
                    if (lower.includes(' and ') || lower.includes(' or ') || lower.includes(' but ') || 
                        lower.includes(' versus ') || lower.includes(' vs ') || lower.includes(' compared to ')) {
                        insights.relationships.push(sentence.trim());
                    }
                });

                // Extract processes (steps, stages)
                sentences.forEach(sentence => {
                    if (sentence.toLowerCase().includes('step') || sentence.toLowerCase().includes('stage') || 
                        sentence.toLowerCase().includes('phase') || sentence.toLowerCase().includes('process')) {
                        insights.processes.push(sentence.trim());
                    }
                });

                // Extract examples
                sentences.forEach(sentence => {
                    if (sentence.toLowerCase().includes('for example') || sentence.toLowerCase().includes('e.g.') || 
                        sentence.toLowerCase().includes('such as') || sentence.toLowerCase().includes('including')) {
                        insights.examples.push(sentence.trim());
                    }
                });

                // Extract implications
                sentences.forEach(sentence => {
                    if (sentence.toLowerCase().includes('therefore') || sentence.toLowerCase().includes('thus') || 
                        sentence.toLowerCase().includes('hence') || sentence.toLowerCase().includes('so ') || 
                        sentence.toLowerCase().includes('as a result')) {
                        insights.implications.push(sentence.trim());
                    }
                });

                // Determine knowledge level based on content complexity
                const complexTerms = this.countComplexTerms(text);
                if (complexTerms > 15) insights.knowledgeLevel = 'advanced';
                else if (complexTerms > 8) insights.knowledgeLevel = 'intermediate';
                else insights.knowledgeLevel = 'beginner';

                return insights;
            }

            isCommonWord(word) {
                const commonWords = new Set([
                    'about', 'above', 'across', 'after', 'again', 'against', 'along', 'among',
                    'around', 'because', 'before', 'below', 'between', 'during', 'except',
                    'inside', 'outside', 'through', 'under', 'until', 'without'
                ]);
                return commonWords.has(word);
            }

            countComplexTerms(text) {
                const complexPatterns = [
                    /[A-Z][a-z]+\s+[A-Z][a-z]+/g,  // Multi-word proper nouns
                    /[A-Z][A-Z]+/g,               // Acronyms
                    /\b\w+ity\b/g,                // Words ending in -ity
                    /\b\w+tion\b/g,               // Words ending in -tion
                    /\b\w+ism\b/g,                // Words ending in -ism
                    /\b\w+logy\b/g                // Words ending in -logy
                ];
                
                let count = 0;
                complexPatterns.forEach(pattern => {
                    const matches = text.match(pattern);
                    if (matches) count += matches.length;
                });
                
                return count;
            }

            generateInsightfulQuestions(insights, count = 10) {
                const questions = [];
                
                if (insights.keyConcepts.length < 2) {
                    throw new Error('Need more detailed content with clear concepts to generate insightful questions.');
                }

                // NotebookLM-style question templates
                const questionTemplates = {
                    conceptual: [
                        {
                            template: "What is the fundamental purpose or main function of {concept} as described in the text?",
                            explanation: "This tests your understanding of the core purpose of {concept}.",
                            level: "Understanding"
                        },
                        {
                            template: "Based on the explanation, what makes {concept} unique or different from similar ideas?",
                            explanation: "This assesses your ability to differentiate {concept} from related concepts.",
                            level: "Analysis"
                        },
                        {
                            template: "According to the text, why is {concept} important or significant?",
                            explanation: "This evaluates your grasp of the significance of {concept}.",
                            level: "Evaluation"
                        }
                    ],
                    application: [
                        {
                            template: "If you encountered a real-world situation involving {concept}, how would you apply the principles described?",
                            explanation: "This tests your ability to apply {concept} in practical scenarios.",
                            level: "Application"
                        },
                        {
                            template: "What would be a concrete example of {concept} based on the information provided?",
                            explanation: "This assesses your ability to generate examples for {concept}.",
                            level: "Application"
                        },
                        {
                            template: "How could you use your understanding of {concept} to solve a problem mentioned in the text?",
                            explanation: "This evaluates problem-solving using {concept}.",
                            level: "Synthesis"
                        }
                    ],
                    analytical: [
                        {
                            template: "What are the key relationships between {concept} and other ideas mentioned in the text?",
                            explanation: "This tests your understanding of how {concept} connects to other concepts.",
                            level: "Analysis"
                        },
                        {
                            template: "Based on the implications discussed, what can be inferred about the role of {concept}?",
                            explanation: "This assesses your ability to draw inferences about {concept}.",
                            level: "Inference"
                        },
                        {
                            template: "What would happen if {concept} was missing or not functioning as described?",
                            explanation: "This evaluates your understanding of the importance of {concept}.",
                            level: "Prediction"
                        }
                    ],
                    synthesis: [
                        {
                            template: "How does understanding {concept} help you better grasp the overall topic discussed?",
                            explanation: "This tests how well you integrate {concept} into the bigger picture.",
                            level: "Synthesis"
                        },
                        {
                            template: "Based on what you've learned, how would you explain {concept} to someone unfamiliar with the topic?",
                            explanation: "This assesses your ability to synthesize and communicate {concept}.",
                            level: "Communication"
                        }
                    ]
                };

                // Select concepts for questions
                const concepts = insights.keyConcepts.map(c => c.concept);
                const usedConcepts = new Set();
                
                // Generate questions with variety
                for (let i = 0; i < count; i++) {
                    const concept = concepts[i % concepts.length];
                    usedConcepts.add(concept);
                    
                    // Distribute question types
                    let category, templateObj;
                    if (i < 4) {
                        category = 'conceptual';
                        templateObj = questionTemplates.conceptual[i % questionTemplates.conceptual.length];
                    } else if (i < 7) {
                        category = 'application';
                        templateObj = questionTemplates.application[(i-4) % questionTemplates.application.length];
                    } else if (i < 9) {
                        category = 'analytical';
                        templateObj = questionTemplates.analytical[(i-7) % questionTemplates.analytical.length];
                    } else {
                        category = 'synthesis';
                        templateObj = questionTemplates.synthesis[(i-9) % questionTemplates.synthesis.length];
                    }
                    
                    const questionText = templateObj.template.replace('{concept}', concept);
                    
                    // Generate intelligent options
                    const { options, correctIndex, explanation } = this.generateInsightfulOptions(
                        concept, 
                        category, 
                        insights,
                        templateObj.level
                    );
                    
                    questions.push({
                        id: i + 1,
                        type: category,
                        concept: concept,
                        text: questionText,
                        options: options,
                        correctAnswer: correctIndex,
                        explanation: explanation,
                        cognitiveLevel: templateObj.level,
                        source: this.findRelevantSource(concept, insights),
                        difficulty: this.calculateQuestionDifficulty(category, templateObj.level)
                    });
                }

                return questions;
            }

            generateInsightfulOptions(concept, category, insights, cognitiveLevel) {
                // Find correct answer based on insights
                let correctAnswer = '';
                let explanation = '';
                
                // Look for concept in insights
                const conceptInfo = insights.keyConcepts.find(c => c.concept === concept);
                if (conceptInfo && conceptInfo.sentence) {
                    // Extract key information from the sentence
                    correctAnswer = this.extractCoreMeaning(conceptInfo.sentence, concept);
                    explanation = `Based on: "${conceptInfo.sentence.substring(0, 120)}..."`;
                } else {
                    // Generate logical answer based on category and cognitive level
                    correctAnswer = this.generateLogicalAnswer(concept, category, cognitiveLevel);
                    explanation = `This represents the most accurate understanding of ${concept} based on the text.`;
                }
                
                // Generate intelligent distractors
                const distractors = this.generateInsightfulDistractors(concept, category, cognitiveLevel, correctAnswer, insights);
                
                // Combine and shuffle
                const allOptions = [correctAnswer, ...distractors];
                const shuffled = this.shuffleArray([...allOptions]);
                const correctIndex = shuffled.indexOf(correctAnswer);
                
                return {
                    options: shuffled,
                    correctIndex: correctIndex,
                    explanation: explanation
                };
            }

            extractCoreMeaning(sentence, concept) {
                // Extract the most meaningful part of the sentence
                const words = sentence.split(' ');
                const conceptIndex = words.findIndex(w => w.includes(concept.split(' ')[0]));
                
                if (conceptIndex !== -1) {
                    // Take context around the concept
                    const start = Math.max(0, conceptIndex - 2);
                    const end = Math.min(words.length, conceptIndex + 6);
                    return words.slice(start, end).join(' ');
                }
                
                // Fallback: take first meaningful part
                return sentence.split(/[,;]/)[0] + '.';
            }

            generateLogicalAnswer(concept, category, level) {
                const answerTemplates = {
                    conceptual: {
                        Understanding: `It serves as ${concept.toLowerCase()} in the system described.`,
                        Analysis: `It differs from similar concepts by ${concept.toLowerCase()} in specific ways mentioned.`,
                        Evaluation: `Its importance lies in how it contributes to ${concept.toLowerCase()} as explained.`
                    },
                    application: {
                        Application: `It can be applied by ${concept.toLowerCase()} in practical situations described.`,
                        Synthesis: `Understanding it helps solve problems through ${concept.toLowerCase()} approaches.`
                    },
                    analytical: {
                        Analysis: `It relates to other concepts through ${concept.toLowerCase()} connections described.`,
                        Inference: `Based on the text, it plays a key role in ${concept.toLowerCase()} processes.`,
                        Prediction: `Without it, the system would lack ${concept.toLowerCase()} capabilities described.`
                    },
                    synthesis: {
                        Synthesis: `It integrates into the overall topic by ${concept.toLowerCase()} relationships.`,
                        Communication: `It can be explained as ${concept.toLowerCase()} based on the provided information.`
                    }
                };
                
                return answerTemplates[category]?.[level] || 
                       `This represents accurate understanding of ${concept} based on the material.`;
            }

            generateInsightfulDistractors(concept, category, level, correctAnswer, insights) {
                const distractors = [];
                
                // Distractor 1: Common misconception
                distractors.push(`This is a common misunderstanding about ${concept} that contradicts the text.`);
                
                // Distractor 2: Overgeneralization
                distractors.push(`This is too broad and doesn't capture the specific nature of ${concept} described.`);
                
                // Distractor 3: Misattribution (confuse with related concept)
                if (insights.keyConcepts.length > 1) {
                    const otherConcepts = insights.keyConcepts
                        .filter(c => c.concept !== concept)
                        .map(c => c.concept);
                    if (otherConcepts.length > 0) {
                        const randomConcept = otherConcepts[Math.floor(Math.random() * otherConcepts.length)];
                        distractors.push(`This actually describes ${randomConcept}, not ${concept}.`);
                    }
                }
                
                // Distractor 4: Opposite or contradictory
                if (correctAnswer.includes(' not ') || correctAnswer.includes('never ') || correctAnswer.includes('no ')) {
                    distractors.push(correctAnswer.replace('not ', '').replace('never ', 'always ').replace('no ', 'yes '));
                } else {
                    distractors.push(`This contradicts what the text states about ${concept}.`);
                }
                
                return distractors.slice(0, 3);
            }

            findRelevantSource(concept, insights) {
                // Find the most relevant sentence for this concept
                const relevant = insights.keyConcepts.find(c => c.concept === concept);
                if (relevant && relevant.sentence) {
                    return relevant.sentence.substring(0, 80) + '...';
                }
                
                // Look in relationships
                for (const relationship of insights.relationships) {
                    if (relationship.includes(concept)) {
                        return relationship.substring(0, 80) + '...';
                    }
                }
                
                return 'Based on overall content';
            }

            calculateQuestionDifficulty(category, level) {
                const difficultyScores = {
                    conceptual: { Understanding: 1, Analysis: 2, Evaluation: 3 },
                    application: { Application: 2, Synthesis: 3 },
                    analytical: { Analysis: 2, Inference: 3, Prediction: 3 },
                    synthesis: { Synthesis: 3, Communication: 2 }
                };
                
                return difficultyScores[category]?.[level] || 2;
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            analyzeLearningPerformance(questions, answers, timeTaken) {
                const analysis = {
                    totalQuestions: questions.length,
                    correctAnswers: 0,
                    accuracy: 0,
                    timePerQuestion: timeTaken / questions.length,
                    
                    // Detailed analysis
                    conceptMastery: {},
                    cognitiveLevelPerformance: {},
                    questionTypePerformance: {},
                    difficultyPerformance: {},
                    
                    // Learning patterns
                    responsePatterns: {
                        consistency: 0,
                        strengths: [],
                        weaknesses: [],
                        learningStyle: '',
                        confidenceLevel: ''
                    }
                };

                // Initialize tracking objects
                questions.forEach(q => {
                    if (!analysis.conceptMastery[q.concept]) {
                        analysis.conceptMastery[q.concept] = { correct: 0, total: 0 };
                    }
                    
                    if (!analysis.cognitiveLevelPerformance[q.cognitiveLevel]) {
                        analysis.cognitiveLevelPerformance[q.cognitiveLevel] = { correct: 0, total: 0 };
                    }
                    
                    if (!analysis.questionTypePerformance[q.type]) {
                        analysis.questionTypePerformance[q.type] = { correct: 0, total: 0 };
                    }
                    
                    if (!analysis.difficultyPerformance[q.difficulty]) {
                        analysis.difficultyPerformance[q.difficulty] = { correct: 0, total: 0 };
                    }
                });

                // Calculate performance
                questions.forEach((question, index) => {
                    const qid = question.id.toString();
                    const isCorrect = answers[qid] === question.correctAnswer;
                    
                    if (isCorrect) analysis.correctAnswers++;
                    
                    // Track concept mastery
                    analysis.conceptMastery[question.concept].total++;
                    if (isCorrect) analysis.conceptMastery[question.concept].correct++;
                    
                    // Track cognitive levels
                    analysis.cognitiveLevelPerformance[question.cognitiveLevel].total++;
                    if (isCorrect) analysis.cognitiveLevelPerformance[question.cognitiveLevel].correct++;
                    
                    // Track question types
                    analysis.questionTypePerformance[question.type].total++;
                    if (isCorrect) analysis.questionTypePerformance[question.type].correct++;
                    
                    // Track difficulty
                    analysis.difficultyPerformance[question.difficulty].total++;
                    if (isCorrect) analysis.difficultyPerformance[question.difficulty].correct++;
                });

                analysis.accuracy = (analysis.correctAnswers / analysis.totalQuestions) * 100;
                
                // Analyze learning patterns
                this.analyzeLearningPatterns(analysis);
                
                return analysis;
            }

            analyzeLearningPatterns(analysis) {
                // Calculate concept mastery levels
                const conceptAccuracies = [];
                for (const [concept, data] of Object.entries(analysis.conceptMastery)) {
                    const accuracy = (data.correct / data.total) * 100;
                    conceptAccuracies.push(accuracy);
                    
                    if (accuracy >= 80) {
                        analysis.responsePatterns.strengths.push(concept);
                    } else if (accuracy <= 50) {
                        analysis.responsePatterns.weaknesses.push(concept);
                    }
                }
                
                // Calculate consistency
                const accuracies = [...conceptAccuracies];
                const maxDiff = Math.max(...accuracies) - Math.min(...accuracies);
                analysis.responsePatterns.consistency = 100 - Math.min(maxDiff, 100);
                
                // Determine learning style based on performance patterns
                const typePerformance = analysis.questionTypePerformance;
                const conceptualScore = typePerformance.conceptual ? 
                    (typePerformance.conceptual.correct / typePerformance.conceptual.total) * 100 : 0;
                const applicationScore = typePerformance.application ? 
                    (typePerformance.application.correct / typePerformance.application.total) * 100 : 0;
                const analyticalScore = typePerformance.analytical ? 
                    (typePerformance.analytical.correct / typePerformance.analytical.total) * 100 : 0;
                const synthesisScore = typePerformance.synthesis ? 
                    (typePerformance.synthesis.correct / typePerformance.synthesis.total) * 100 : 0;
                
                // Determine primary learning style
                const scores = [
                    { type: 'conceptual', score: conceptualScore },
                    { type: 'application', score: applicationScore },
                    { type: 'analytical', score: analyticalScore },
                    { type: 'synthesis', score: synthesisScore }
                ].sort((a, b) => b.score - a.score);
                
                if (scores[0].score >= 70 && scores[0].score - scores[1].score > 15) {
                    analysis.responsePatterns.learningStyle = scores[0].type.charAt(0).toUpperCase() + scores[0].type.slice(1) + ' Learner';
                } else if (analysis.responsePatterns.consistency >= 70) {
                    analysis.responsePatterns.learningStyle = 'Balanced Learner';
                } else {
                    analysis.responsePatterns.learningStyle = 'Developing Learner';
                }
                
                // Determine confidence level
                if (analysis.accuracy >= 80) {
                    analysis.responsePatterns.confidenceLevel = 'High Confidence';
                } else if (analysis.accuracy >= 60) {
                    analysis.responsePatterns.confidenceLevel = 'Moderate Confidence';
                } else if (analysis.accuracy >= 40) {
                    analysis.responsePatterns.confidenceLevel = 'Developing Confidence';
                } else {
                    analysis.responsePatterns.confidenceLevel = 'Needs Foundation';
                }
            }

            generateLearningProfile(analysis) {
                const profile = {
                    level: this.determineLearningLevel(analysis.accuracy, analysis.responsePatterns.consistency),
                    style: analysis.responsePatterns.learningStyle,
                    confidence: analysis.responsePatterns.confidenceLevel,
                    strengths: analysis.responsePatterns.strengths.slice(0, 3),
                    weaknesses: analysis.responsePatterns.weaknesses.slice(0, 3),
                    recommendations: this.generateRecommendations(analysis)
                };
                
                return profile;
            }

            determineLearningLevel(accuracy, consistency) {
                if (accuracy >= 85 && consistency >= 80) {
                    return { name: 'Advanced', description: 'Strong conceptual grasp with consistent performance' };
                } else if (accuracy >= 70 && consistency >= 70) {
                    return { name: 'Intermediate', description: 'Good understanding with room for refinement' };
                } else if (accuracy >= 50) {
                    return { name: 'Developing', description: 'Basic understanding, needs more practice' };
                } else {
                    return { name: 'Beginner', description: 'Foundation building phase' };
                }
            }

            generateRecommendations(analysis) {
                const recommendations = {
                    studyTechniques: [],
                    focusAreas: [],
                    timeAllocation: '',
                    practiceStrategies: [],
                    commonPitfalls: []
                };
                
                // Study techniques based on learning style
                const techniqueMap = {
                    'Conceptual Learner': ['Feynman Technique', 'Concept Mapping', 'Teaching Others'],
                    'Application Learner': ['Case Studies', 'Problem-based Learning', 'Real-world Projects'],
                    'Analytical Learner': ['Socratic Questioning', 'Critical Analysis', 'Debate Practice'],
                    'Synthesis Learner': ['Integration Exercises', 'Big Picture Mapping', 'Connection Building'],
                    'Balanced Learner': ['Interleaving', 'Mixed Practice', 'Holistic Review'],
                    'Developing Learner': ['Foundational Review', 'Step-by-step Practice', 'Guided Learning']
                };
                
                recommendations.studyTechniques = techniqueMap[analysis.responsePatterns.learningStyle] || 
                    ['Active Recall', 'Spaced Repetition', 'Practice Testing'];
                
                // Focus areas based on weaknesses
                if (analysis.responsePatterns.weaknesses.length > 0) {
                    recommendations.focusAreas = analysis.responsePatterns.weaknesses.slice(0, 3);
                }
                
                // Time allocation based on accuracy
                if (analysis.accuracy >= 80) {
                    recommendations.timeAllocation = '30% review, 40% advanced applications, 30% new topics';
                } else if (analysis.accuracy >= 60) {
                    recommendations.timeAllocation = '40% weak areas, 40% moderate areas, 20% review strong areas';
                } else {
                    recommendations.timeAllocation = '60% foundational concepts, 30% practice, 10% review';
                }
                
                // Practice strategies
                recommendations.practiceStrategies = [
                    'Regular self-testing with varied question types',
                    'Explain concepts in your own words',
                    'Connect new information to existing knowledge',
                    'Create summary notes after each study session'
                ];
                
                // Common pitfalls to avoid
                recommendations.commonPitfalls = [
                    'Passive reading without active engagement',
                    'Only practicing comfortable topics',
                    'Cramming without understanding',
                    'Ignoring feedback from incorrect answers'
                ];
                
                return recommendations;
            }
        }

        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            const aiEngine = new NotebookLMStyleEngine();
            let currentQuestions = [];
            let userAnswers = {};
            let quizStartTime = null;
            let timerInterval = null;
            let currentQuestion = 0;

            // DOM Elements
            const elements = {
                textInput: document.getElementById('textInput'),
                wordCount: document.getElementById('wordCount'),
                qualityIndicator: document.getElementById('qualityIndicator'),
                analyzeBtn: document.getElementById('analyzeTextBtn'),
                processing: document.getElementById('processingArea'),
                analysisPreview: document.getElementById('analysisPreview'),
                analysisDetails: document.getElementById('analysisDetails'),
                quizSection: document.getElementById('quizSection'),
                quizQuestions: document.getElementById('quizQuestions'),
                progressText: document.getElementById('progressText'),
                quizProgress: document.getElementById('quizProgress'),
                prevBtn: document.getElementById('prevQuestionBtn'),
                nextBtn: document.getElementById('nextQuestionBtn'),
                submitBtn: document.getElementById('submitQuizBtn'),
                resultsSection: document.getElementById('resultsSection'),
                errorAlert: document.getElementById('errorAlert'),
                successAlert: document.getElementById('successAlert')
            };

            // Word count and quality tracking
            elements.textInput.addEventListener('input', function() {
                const text = this.value.trim();
                const words = text === '' ? 0 : text.split(/\s+/).length;
                elements.wordCount.textContent = `${words} words (minimum: 200)`;
                
                if (words >= 200) {
                    elements.wordCount.className = 'word-count';
                    elements.analyzeBtn.disabled = false;
                    
                    // Analyze quality
                    const quality = aiEngine.analyzeContentQuality(text);
                    elements.qualityIndicator.textContent = `Quality: ${quality.quality}`;
                    elements.qualityIndicator.className = `quality-indicator ${
                        quality.score >= 50 ? 'quality-good' : 'quality-poor'
                    }`;
                } else if (words >= 100) {
                    elements.wordCount.className = 'word-count warning';
                    elements.analyzeBtn.disabled = true;
                    elements.qualityIndicator.textContent = 'Add more content for better analysis';
                    elements.qualityIndicator.className = 'quality-indicator quality-poor';
                } else {
                    elements.wordCount.className = 'word-count error';
                    elements.analyzeBtn.disabled = true;
                    elements.qualityIndicator.textContent = 'Tip: Include definitions, examples, and explanations';
                    elements.qualityIndicator.className = 'quality-indicator';
                }
            });

            // Load sample text
            document.getElementById('sampleTextBtn').addEventListener('click', function() {
                const sampleText = `Photosynthesis: The Biochemical Process of Energy Conversion

Definition: Photosynthesis is the process by which plants, algae, and some bacteria convert light energy into chemical energy stored in glucose and other organic compounds. This process is fundamental to life on Earth because it produces oxygen and forms the base of most food chains.

The Two Main Stages:
1. Light-dependent reactions occur in the thylakoid membranes of chloroplasts. Chlorophyll molecules absorb light energy, which excites electrons and splits water molecules into oxygen, protons, and electrons. This stage produces ATP and NADPH as energy carriers through electron transport chains.

2. Calvin cycle (light-independent reactions) takes place in the stroma of chloroplasts. Here, carbon dioxide is fixed and converted into glucose using the ATP and NADPH produced in the light reactions. The enzyme RuBisCO catalyzes the first step of carbon fixation, combining CO2 with a five-carbon compound.

Key Factors Affecting Rate:
- Light intensity: Increases rate until saturation point is reached
- Carbon dioxide concentration: Limited by atmospheric levels (0.04%)
- Temperature: Optimal around 25-30Â°C for most plants
- Water availability: Essential for electron transport and maintaining turgor pressure

Adaptations for Efficiency:
C4 plants like corn use a specialized pathway to concentrate CO2 around RuBisCO, increasing efficiency in hot conditions. CAM plants like cacti open stomata at night to take in CO2, storing it as malic acid for daytime use, minimizing water loss.

Importance and Applications:
Understanding photosynthesis is crucial for addressing climate change (carbon sequestration), improving agricultural productivity, and developing sustainable energy solutions through artificial photosynthesis research.

Comparison with Cellular Respiration:
While photosynthesis stores energy by building glucose from CO2 and water, cellular respiration releases energy by breaking down glucose. These complementary processes form a continuous cycle of energy transformation in ecosystems.`;
                
                elements.textInput.value = sampleText;
                elements.textInput.dispatchEvent(new Event('input'));
            });

            // Start diagnostic
            document.getElementById('startBtn').addEventListener('click', function() {
                document.getElementById('diagnostic').scrollIntoView({ behavior: 'smooth' });
                elements.textInput.focus();
            });

            // Analyze text and generate quiz
            elements.analyzeBtn.addEventListener('click', function() {
                const text = elements.textInput.value.trim();
                
                if (text.split(/\s+/).length < 150) {
                    showError('Please enter at least 150 words for insightful analysis.');
                    return;
                }
                
                elements.processing.style.display = 'block';
                elements.analyzeBtn.disabled = true;
                
                // Simulate AI processing
                setTimeout(() => {
                    try {
                        // Analyze content quality
                        const quality = aiEngine.analyzeContentQuality(text);
                        
                        if (quality.score < 30) {
                            showError('Content needs more definitions and explanations for good questions. Add more detail.');
                            return;
                        }
                        
                        // Extract insights
                        const insights = aiEngine.extractCoreInsights(text);
                        
                        // Generate questions
                        currentQuestions = aiEngine.generateInsightfulQuestions(insights, 10);
                        
                        // Show analysis preview
                        elements.analysisDetails.innerHTML = `
                            <p><i class="fas fa-check-circle"></i> Found ${insights.keyConcepts.length} key concepts</p>
                            <p><i class="fas fa-project-diagram"></i> Identified ${insights.relationships.length} relationships</p>
                            <p><i class="fas fa-question-circle"></i> Generated ${currentQuestions.length} insightful questions</p>
                            <p><i class="fas fa-brain"></i> Cognitive levels: Understanding â†’ Analysis â†’ Synthesis</p>
                        `;
                        elements.analysisPreview.style.display = 'block';
                        
                        showSuccess('Analysis complete! Ready to generate NotebookLM-style quiz.');
                        
                        // Start quiz
                        setTimeout(() => startQuiz(), 1000);
                        
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        elements.processing.style.display = 'none';
                        elements.analyzeBtn.disabled = false;
                    }
                }, 2000);
            });

            // Start quiz
            function startQuiz() {
                if (!currentQuestions || currentQuestions.length === 0) return;
                
                elements.quizSection.style.display = 'block';
                currentQuestion = 0;
                userAnswers = {};
                quizStartTime = Date.now();
                
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
                
                renderQuestion();
                updateNavigation();
                
                elements.quizSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Render question
            function renderQuestion() {
                if (!currentQuestions || !currentQuestions[currentQuestion]) return;
                
                const question = currentQuestions[currentQuestion];
                elements.progressText.textContent = `Question ${currentQuestion + 1} of ${currentQuestions.length}`;
                
                const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
                elements.quizProgress.style.width = `${progress}%`;
                
                // Get question type styling
                const typeClass = question.type;
                const typeIcon = {
                    conceptual: 'fa-lightbulb',
                    application: 'fa-cogs',
                    analytical: 'fa-search',
                    synthesis: 'fa-project-diagram'
                }[question.type] || 'fa-question';
                
                // Generate options HTML
                let optionsHTML = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                question.options.forEach((option, index) => {
                    let optionClass = 'option';
                    const qid = question.id.toString();
                    if (userAnswers[qid] === index) {
                        optionClass += ' selected';
                    }
                    
                    optionsHTML += `
                        <div class="${optionClass}" data-index="${index}" data-question="${qid}">
                            <div class="option-letter">${letters[index]}</div>
                            <div class="option-content">
                                <div>${option}</div>
                            </div>
                        </div>
                    `;
                });
                
                // Build question HTML
                elements.quizQuestions.innerHTML = `
                    <div class="quiz-question">
                        <div class="question-meta">
                            <div class="question-type ${typeClass}">
                                <i class="fas ${typeIcon}"></i> ${question.cognitiveLevel}
                            </div>
                            <div>
                                <i class="fas fa-tag"></i> ${question.concept}
                            </div>
                        </div>
                        <div class="question-text">
                            ${question.text}
                        </div>
                        <div class="options-grid">
                            ${optionsHTML}
                        </div>
                        <div style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                            <i class="fas fa-info-circle"></i> Source: ${question.source}
                        </div>
                    </div>
                `;
                
                // Add event listeners to options
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        const questionId = this.getAttribute('data-question');
                        
                        document.querySelectorAll(`[data-question="${questionId}"]`).forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        this.classList.add('selected');
                        userAnswers[questionId] = selectedIndex;
                        
                        const allAnswered = Object.keys(userAnswers).length === currentQuestions.length;
                        elements.submitBtn.style.display = allAnswered ? 'block' : 'none';
                    });
                });
            }

            // Navigation
            elements.nextBtn.addEventListener('click', () => {
                if (currentQuestion < currentQuestions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                    updateNavigation();
                }
            });

            elements.prevBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    updateNavigation();
                }
            });

            function updateNavigation() {
                elements.prevBtn.disabled = currentQuestion === 0;
                elements.nextBtn.disabled = currentQuestion === currentQuestions.length - 1;
            }

            // Timer
            function updateTimer() {
                if (!quizStartTime) return;
                
                const now = Date.now();
                const diff = Math.floor((now - quizStartTime) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                
                document.getElementById('quizTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Submit quiz
            elements.submitBtn.addEventListener('click', function() {
                clearInterval(timerInterval);
                const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
                
                elements.submitBtn.disabled = true;
                elements.submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
                
                setTimeout(() => {
                    try {
                        const performance = aiEngine.analyzeLearningPerformance(currentQuestions, userAnswers, timeTaken);
                        const profile = aiEngine.generateLearningProfile(performance);
                        
                        showResults(performance, profile, timeTaken);
                        
                    } catch (error) {
                        showError('Error analyzing results: ' + error.message);
                    } finally {
                        elements.submitBtn.disabled = false;
                        elements.submitBtn.innerHTML = '<i class="fas fa-chart-line"></i> Submit & Get Deep Analysis';
                    }
                }, 1500);
            });

            // Show results
            function showResults(performance, profile, timeTaken) {
                elements.quizSection.style.display = 'none';
                elements.resultsSection.style.display = 'block';
                
                // Create topics breakdown
                let topicsHTML = '';
                
                if (profile.strengths.length > 0) {
                    profile.strengths.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item strong">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--success);">Strength</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">You show strong understanding</p>
                            </div>
                        `;
                    });
                }
                
                if (profile.weaknesses.length > 0) {
                    profile.weaknesses.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item weak">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--danger);">Focus Area</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">Priority for improvement</p>
                            </div>
                        `;
                    });
                }
                
                // Create study plan
                let studyPlanHTML = '';
                if (profile.recommendations.studyTechniques.length > 0) {
                    profile.recommendations.studyTechniques.forEach((tech, index) => {
                        studyPlanHTML += `<li><strong>${index === 0 ? 'Primary: ' : ''}</strong>${tech}</li>`;
                    });
                }
                
                // Build results HTML
                elements.resultsSection.innerHTML = `
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-icon" style="background: linear-gradient(135deg, ${profile.level.name === 'Advanced' ? '#4cc9f0' : profile.level.name === 'Intermediate' ? '#f8961e' : '#f72585'}, #4361ee);">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div style="flex: 1;">
                                <h2 style="color: var(--secondary); margin-bottom: 10px;">Learning Profile</h2>
                                <h3 style="color: ${profile.level.name === 'Advanced' ? '#4cc9f0' : profile.level.name === 'Intermediate' ? '#f8961e' : '#f72585'}; margin-bottom: 10px;">
                                    <span class="learning-level level-${profile.level.name.toLowerCase()}">${profile.level.name}</span> â€¢ ${profile.style}
                                </h3>
                                <p style="color: var(--gray); line-height: 1.6;">${profile.level.description}</p>
                                <p style="margin-top: 10px;"><strong>Confidence Level:</strong> ${profile.confidence}</p>
                            </div>
                        </div>
                        
                        <div class="confidence-meter">
                            <div class="meter-label">
                                <span style="font-size: 1.1rem;">Performance Score</span>
                                <strong style="font-size: 1.5rem; color: ${performance.accuracy >= 70 ? 'var(--success)' : performance.accuracy >= 50 ? 'var(--warning)' : 'var(--danger)'};">${performance.accuracy.toFixed(1)}%</strong>
                            </div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: ${performance.accuracy}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                                <span>${performance.correctAnswers} / ${performance.totalQuestions} correct</span>
                                <span>Consistency: ${performance.responsePatterns.consistency.toFixed(0)}%</span>
                                <span>Time: ${Math.floor(timeTaken/60)}:${(timeTaken%60).toString().padStart(2, '0')}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${topicsHTML ? `
                    <div class="profile-card">
                        <h3 style="color: var(--secondary); margin-bottom: 20px;">
                            <i class="fas fa-chart-bar"></i> Concept Analysis
                        </h3>
                        <div class="topics-breakdown">
                            ${topicsHTML}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="study-plan">
                        <div class="technique-recommendation">
                            <div class="tech-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--secondary); margin-bottom: 10px;">Personalized Study Strategy</h3>
                                <p style="color: var(--gray);">Optimized for your ${profile.style.toLowerCase()} profile</p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--secondary); margin: 20px 0 15px;">Recommended Techniques:</h4>
                        <ol class="steps-list">
                            ${studyPlanHTML}
                        </ol>
                        
                        <div class="insight-box">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> Key Insights</h4>
                            <ul style="padding-left: 20px; color: var(--gray);">
                                <li>${profile.recommendations.focusAreas.length > 0 ? `Focus on: ${profile.recommendations.focusAreas.join(', ')}` : 'Your understanding is well-balanced'}</li>
                                <li>Time allocation: ${profile.recommendations.timeAllocation}</li>
                                <li>Practice explaining concepts in your own words</li>
                                <li>Connect new information to what you already know</li>
                            </ul>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 25px 0;">
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--secondary); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-clock"></i> Study Schedule</h4>
                                <p style="font-size: 0.9rem; color: var(--gray);">Daily: 45-60 minutes</p>
                                <p style="font-size: 0.9rem; color: var(--gray);">Weekly: 5-6 sessions</p>
                                <p style="font-size: 0.9rem; color: var(--gray);">Focus: ${profile.recommendations.timeAllocation}</p>
                            </div>
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--danger); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> Avoid These Pitfalls</h4>
                                <ul style="padding-left: 20px; font-size: 0.9rem; color: var(--gray);">
                                    ${profile.recommendations.commonPitfalls.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn btn-primary" id="newDiagnosticBtn">
                                <i class="fas fa-redo"></i> Start New Diagnostic
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listener for new diagnostic
                document.getElementById('newDiagnosticBtn').addEventListener('click', function() {
                    location.reload();
                });
                
                // Animate progress bar
                setTimeout(() => {
                    const fill = document.querySelector('.meter-fill');
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                }, 300);
                
                elements.resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Utility functions
            function showError(message) {
                elements.errorAlert.textContent = message;
                elements.errorAlert.style.display = 'block';
                setTimeout(() => {
                    elements.errorAlert.style.display = 'none';
                }, 5000);
            }

            function showSuccess(message) {
                elements.successAlert.textContent = message;
                elements.successAlert.style.display = 'block';
                setTimeout(() => {
                    elements.successAlert.style.display = 'none';
                }, 5000);
            }

            // Initialize
            elements.textInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
