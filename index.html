<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMind AI | Diagnostic Learning Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #f94144;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f9ff 0%, #f0f5ff 100%);
            color: var(--dark);
            line-height: 1.7;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 80px 20px 60px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.2rem;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
            font-weight: 800;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--gray);
            margin-bottom: 40px;
        }

        /* Diagnostic Section */
        .diagnostic-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin-bottom: 80px;
            position: relative;
            overflow: hidden;
        }

        .diagnostic-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            color: var(--secondary);
            font-size: 2rem;
            font-weight: 700;
        }

        /* Text Input Area */
        .text-input-area {
            margin-bottom: 40px;
        }

        .text-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-count {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .word-count.warning {
            color: var(--warning);
        }

        .word-count.error {
            color: var(--danger);
        }

        .text-input-container {
            position: relative;
        }

        .text-input {
            width: 100%;
            min-height: 250px;
            padding: 25px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: #fdfdfd;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .text-input::placeholder {
            color: var(--gray);
        }

        .text-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .sample-text-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.9rem;
        }

        .sample-text-btn:hover {
            color: var(--secondary);
        }

        /* Processing Animation */
        .processing-area {
            display: none;
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(135deg, #f8fbff, #f0f5ff);
            border-radius: var(--border-radius);
            margin: 30px 0;
            border: 2px dashed var(--primary-light);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(67, 97, 238, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quiz Section */
        .quiz-section {
            display: none;
            margin-top: 40px;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .progress-container {
            flex: 1;
            margin-right: 30px;
        }

        .progress-bar {
            height: 10px;
            background: var(--gray-light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 5px;
        }

        .quiz-question {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .question-type {
            background: var(--gray-light);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .conceptual { background: #e3f2fd; color: #1565c0; }
        .application { background: #e8f5e9; color: #2e7d32; }
        .definition { background: #fff3e0; color: #ef6c00; }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 25px;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option {
            padding: 18px 20px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: #f8fbff;
            transform: translateY(-2px);
        }

        .option.selected {
            border-color: var(--primary);
            background: #eef2ff;
            transform: translateY(-2px);
        }

        .option-letter {
            width: 36px;
            height: 36px;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .selected .option-letter {
            background: var(--primary);
            color: white;
        }

        /* Results Section */
        .results-section {
            display: none;
            margin-top: 40px;
        }

        .profile-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 35px;
            margin-bottom: 25px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .confidence-meter {
            margin-bottom: 30px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .meter-bar {
            height: 12px;
            background: var(--gray-light);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1.5s ease;
            border-radius: 6px;
        }

        .topics-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .topic-item {
            padding: 20px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .topic-item.strong {
            border-left: 4px solid var(--success);
            background: linear-gradient(135deg, #f0fff4, #e6ffed);
        }

        .topic-item.weak {
            border-left: 4px solid var(--danger);
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        .topic-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        /* Study Plan */
        .study-plan {
            background: linear-gradient(135deg, #f8fbff, #eef2ff);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 30px 0;
            border-left: 5px solid var(--accent);
        }

        .technique-recommendation {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .tech-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #ff6b9d);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .steps-list {
            list-style: none;
            margin: 20px 0;
        }

        .steps-list li {
            padding: 15px 15px 15px 50px;
            position: relative;
            margin-bottom: 12px;
            background: white;
            border-radius: 8px;
        }

        .steps-list li::before {
            content: '✓';
            position: absolute;
            left: 15px;
            top: 15px;
            width: 24px;
            height: 24px;
            background: var(--success);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .btn-large {
            padding: 16px 40px;
            font-size: 1.1rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .alert-error {
            background: #fff5f5;
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: #f0fff4;
            border-left: 4px solid var(--success);
            color: #2e7d32;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .diagnostic-container {
                padding: 25px 20px;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .technique-recommendation {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span>StudyMind AI</span>
            </div>
            <nav>
                <a href="#diagnostic" style="text-decoration: none; color: var(--dark); font-weight: 500;">Diagnostic</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>AI-Powered Diagnostic Learning</h1>
            <p>Paste your study material. Get a personalized diagnostic quiz, learning analysis, and custom study plan.</p>
            <button class="btn btn-primary btn-large" id="startBtn">
                <i class="fas fa-play-circle"></i> Start Diagnostic
            </button>
        </div>
    </section>

    <!-- Diagnostic Section -->
    <section id="diagnostic" class="container">
        <div class="diagnostic-container">
            <h2 class="section-title">AI Diagnostic Quiz Generator</h2>
            
            <!-- Alert Messages -->
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <!-- Text Input Area -->
            <div class="text-input-area">
                <div class="text-input-header">
                    <h3>Paste Your Study Content</h3>
                    <div class="word-count" id="wordCount">0 words (minimum: 50)</div>
                </div>
                
                <div class="text-input-container">
                    <textarea class="text-input" id="textInput" placeholder="Paste your textbook content, lecture notes, or study material here..."></textarea>
                </div>
                
                <div class="text-input-footer">
                    <div>
                        <i class="fas fa-info-circle"></i> Paste at least 50 words for analysis
                    </div>
                    <button class="sample-text-btn" id="sampleTextBtn">
                        <i class="fas fa-magic"></i> Load Sample Text
                    </button>
                </div>
            </div>

            <!-- Generate Quiz Button -->
            <div style="text-align: center;">
                <button class="btn btn-primary btn-large" id="analyzeTextBtn">
                    <i class="fas fa-bolt"></i> Analyze Text & Generate Quiz
                </button>
            </div>

            <!-- Processing Animation -->
            <div class="processing-area" id="processingArea">
                <div class="spinner"></div>
                <h3>AI is Analyzing Your Content</h3>
                <p>Extracting concepts and generating personalized questions...</p>
            </div>

            <!-- Quiz Section -->
            <div class="quiz-section" id="quizSection">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quizProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray);">
                            <span>Progress</span>
                            <span id="progressText">Question 1 of 10</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--secondary);">AI Diagnostic Quiz</div>
                        <div style="color: var(--gray); font-size: 0.9rem; margin-top: 5px;">Time: <span id="quizTime">00:00</span></div>
                    </div>
                </div>

                <div id="quizQuestions">
                    <!-- Questions will be inserted here -->
                </div>

                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                    <button class="btn btn-secondary" id="prevQuestionBtn" disabled>
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-primary" id="nextQuestionBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-large" id="submitQuizBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <!-- Results will be inserted here -->
            </div>
        </div>
    </section>

    <script>
        // Text Analysis and Quiz Generation Engine
        class StudyMindAI {
            constructor() {
                this.concepts = new Map();
                this.topics = [];
                this.questions = [];
                this.analysis = null;
            }

            extractConcepts(text) {
                const concepts = new Map();
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
                
                // Find definitions
                sentences.forEach(sentence => {
                    const lower = sentence.toLowerCase();
                    
                    // Look for definitions
                    if (lower.includes('is defined as') || lower.includes('refers to') || 
                        lower.includes('known as') || lower.includes('called')) {
                        const words = sentence.split(' ');
                        if (words.length > 3) {
                            const concept = words[0];
                            concepts.set(concept, {
                                type: 'definition',
                                content: sentence,
                                frequency: 1
                            });
                        }
                    }
                    
                    // Look for key terms (capitalized words)
                    const capitalizedWords = sentence.match(/\b[A-Z][a-z]+\b/g) || [];
                    capitalizedWords.forEach(word => {
                        if (word.length > 3 && !['The', 'This', 'That', 'These', 'Those'].includes(word)) {
                            const existing = concepts.get(word);
                            if (existing) {
                                existing.frequency++;
                            } else {
                                concepts.set(word, {
                                    type: 'term',
                                    content: '',
                                    frequency: 1
                                });
                            }
                        }
                    });
                });

                // Convert to array and sort by frequency
                const conceptsArray = Array.from(concepts.entries())
                    .filter(([_, info]) => info.frequency > 1 || info.type === 'definition')
                    .slice(0, 15); // Limit to top 15 concepts

                this.concepts = new Map(conceptsArray);
                return this.concepts;
            }

            identifyTopics(text) {
                const topics = [];
                const lines = text.split('\n').filter(line => line.trim().length > 0);
                
                // Look for headings/topics
                lines.forEach(line => {
                    const trimmed = line.trim();
                    // Check if line looks like a heading
                    if (trimmed.length < 100 && 
                        (trimmed.endsWith(':') || 
                         trimmed.split(' ').length <= 6 ||
                         /^[A-Z][^a-z]*$/.test(trimmed) ||
                         /^\d+\./.test(trimmed))) {
                        topics.push(trimmed.replace(/[:•]/g, '').trim());
                    }
                });

                // If no headings found, use some generic topics
                if (topics.length === 0) {
                    topics.push('Key Concepts', 'Main Ideas', 'Important Points', 'Core Principles');
                }

                this.topics = topics.slice(0, 6);
                return this.topics;
            }

            generateQuestions() {
                const questions = [];
                const concepts = Array.from(this.concepts.entries());
                
                if (concepts.length === 0) {
                    throw new Error('No concepts found in text. Please provide more detailed content.');
                }

                // Question templates
                const templates = {
                    conceptual: [
                        "What is the main purpose of {concept} as described in the text?",
                        "How would you explain {concept} in simple terms?",
                        "What is unique about {concept} compared to other ideas?",
                        "Why is {concept} important according to the text?"
                    ],
                    application: [
                        "How could you apply {concept} in a practical situation?",
                        "What would be a real-world example of {concept}?",
                        "If you encountered a problem involving {concept}, what would you do?",
                        "How does {concept} help solve problems mentioned in the text?"
                    ],
                    definition: [
                        "Which definition best matches {concept}?",
                        "What key characteristic defines {concept}?",
                        "What is the scope of {concept} based on the description?",
                        "What does {concept} primarily involve?"
                    ]
                };

                // Generate 10 questions
                for (let i = 0; i < 10; i++) {
                    const concept = concepts[i % concepts.length];
                    const type = i < 4 ? 'conceptual' : i < 7 ? 'application' : 'definition';
                    const template = templates[type][i % templates[type].length];
                    
                    const question = {
                        id: i + 1,
                        type: type,
                        concept: concept[0],
                        text: template.replace('{concept}', concept[0]),
                        options: this.generateOptions(concept, type),
                        correctAnswer: 0,
                        explanation: `This answer correctly reflects the information about ${concept[0]} provided in the text.`
                    };
                    
                    questions.push(question);
                }

                this.questions = questions;
                return questions;
            }

            generateOptions(concept, type) {
                const [conceptName, conceptInfo] = concept;
                const options = [];
                
                // Correct answer based on type
                let correctAnswer = '';
                switch(type) {
                    case 'definition':
                        correctAnswer = `It describes ${conceptName} accurately based on the text content.`;
                        break;
                    case 'application':
                        correctAnswer = `It shows how ${conceptName} can be used in real situations.`;
                        break;
                    case 'conceptual':
                    default:
                        correctAnswer = `It captures the essence of ${conceptName} as described.`;
                }
                
                options.push(correctAnswer);
                
                // Distractors
                const distractors = [
                    `This is actually about a different concept, not ${conceptName}.`,
                    `This contradicts the information about ${conceptName} in the text.`,
                    `This is too vague and doesn't specifically describe ${conceptName}.`,
                    `While related, this is not the main focus of ${conceptName}.`
                ];
                
                // Add 3 distractors
                for (let i = 0; i < 3; i++) {
                    options.push(distractors[i]);
                }
                
                // Shuffle options
                return this.shuffleArray(options);
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            analyzeResponses(answers, timeTaken) {
                const totalQuestions = this.questions.length;
                let correct = 0;
                const conceptPerformance = new Map();
                const typePerformance = {
                    conceptual: { correct: 0, total: 0 },
                    application: { correct: 0, total: 0 },
                    definition: { correct: 0, total: 0 }
                };

                // Calculate scores
                this.questions.forEach((question, index) => {
                    const qid = (index + 1).toString();
                    const isCorrect = answers[qid] === 0; // First option is always correct
                    
                    // Track overall
                    if (isCorrect) correct++;
                    
                    // Track by concept
                    const concept = question.concept;
                    if (!conceptPerformance.has(concept)) {
                        conceptPerformance.set(concept, { correct: 0, total: 0 });
                    }
                    const perf = conceptPerformance.get(concept);
                    perf.total++;
                    if (isCorrect) perf.correct++;
                    
                    // Track by type
                    typePerformance[question.type].total++;
                    if (isCorrect) typePerformance[question.type].correct++;
                });

                const accuracy = (correct / totalQuestions) * 100;
                
                // Determine learning profile
                const profile = this.determineLearningProfile(typePerformance);
                
                // Identify strong/weak concepts
                const strongConcepts = [];
                const weakConcepts = [];
                
                conceptPerformance.forEach((perf, concept) => {
                    const conceptAccuracy = (perf.correct / perf.total) * 100;
                    if (conceptAccuracy >= 80) {
                        strongConcepts.push(concept);
                    } else if (conceptAccuracy <= 50) {
                        weakConcepts.push(concept);
                    }
                });

                this.analysis = {
                    accuracy,
                    correct,
                    total: totalQuestions,
                    timePerQuestion: timeTaken / totalQuestions,
                    profile,
                    strongConcepts: strongConcepts.slice(0, 5),
                    weakConcepts: weakConcepts.slice(0, 5),
                    recommendations: this.generateRecommendations(profile, strongConcepts, weakConcepts)
                };

                return this.analysis;
            }

            determineLearningProfile(typePerformance) {
                const conceptualScore = (typePerformance.conceptual.correct / typePerformance.conceptual.total) * 100 || 0;
                const applicationScore = (typePerformance.application.correct / typePerformance.application.total) * 100 || 0;
                const definitionScore = (typePerformance.definition.correct / typePerformance.definition.total) * 100 || 0;

                if (conceptualScore >= 80 && applicationScore < 60) {
                    return {
                        type: 'Conceptual',
                        description: 'You excel at understanding underlying principles and making connections between ideas.',
                        icon: 'fa-lightbulb',
                        color: '#f8961e'
                    };
                } else if (definitionScore >= 80 && conceptualScore < 60) {
                    return {
                        type: 'Rote Learner',
                        description: 'You are strong at memorizing facts and recalling specific details.',
                        icon: 'fa-brain',
                        color: '#f72585'
                    };
                } else if (applicationScore >= 80 && definitionScore < 60) {
                    return {
                        type: 'Application-Oriented',
                        description: 'You learn best by applying knowledge to practical situations.',
                        icon: 'fa-cogs',
                        color: '#4cc9f0'
                    };
                } else {
                    return {
                        type: 'Balanced',
                        description: 'You have well-rounded abilities across different types of learning.',
                        icon: 'fa-balance-scale',
                        color: '#4361ee'
                    };
                }
            }

            generateRecommendations(profile, strongConcepts, weakConcepts) {
                const techniques = {
                    'Conceptual': ['Feynman Technique', 'Concept Mapping', 'Teaching Others'],
                    'Rote Learner': ['Spaced Repetition', 'Active Recall', 'Flashcards'],
                    'Application-Oriented': ['Practice Problems', 'Case Studies', 'Real-world Projects'],
                    'Balanced': ['Interleaving', 'Mixed Practice', 'Self-testing']
                };

                const studyPlan = [];
                
                // Focus areas
                if (weakConcepts.length > 0) {
                    studyPlan.push(`Focus on: ${weakConcepts.slice(0, 3).join(', ')}`);
                }
                if (strongConcepts.length > 0) {
                    studyPlan.push(`Review regularly: ${strongConcepts.slice(0, 3).join(', ')}`);
                }
                
                // Study techniques
                studyPlan.push(`Use ${techniques[profile.type][0]} for deep learning`);
                studyPlan.push('Practice explaining concepts aloud');
                studyPlan.push('Create summary notes after each session');
                studyPlan.push('Test yourself regularly');
                studyPlan.push('Connect new concepts to what you already know');

                return {
                    techniques: techniques[profile.type],
                    studyPlan,
                    dailyTime: '45-60 minutes',
                    focusRatio: '60% weak topics, 30% medium, 10% strong',
                    avoid: [
                        'Passive reading without testing',
                        'Cramming all at once',
                        'Ignoring weak areas',
                        'Studying without breaks'
                    ]
                };
            }
        }

        // Main Application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AI Engine
            const aiEngine = new StudyMindAI();
            
            // DOM Elements
            const textInput = document.getElementById('textInput');
            const wordCount = document.getElementById('wordCount');
            const analyzeTextBtn = document.getElementById('analyzeTextBtn');
            const processingArea = document.getElementById('processingArea');
            const quizSection = document.getElementById('quizSection');
            const quizQuestions = document.getElementById('quizQuestions');
            const progressText = document.getElementById('progressText');
            const quizProgress = document.getElementById('quizProgress');
            const prevQuestionBtn = document.getElementById('prevQuestionBtn');
            const nextQuestionBtn = document.getElementById('nextQuestionBtn');
            const submitQuizBtn = document.getElementById('submitQuizBtn');
            const resultsSection = document.getElementById('resultsSection');
            const errorAlert = document.getElementById('errorAlert');
            const successAlert = document.getElementById('successAlert');

            // State
            let currentQuestion = 0;
            let userAnswers = {};
            let quizStartTime = null;
            let timerInterval = null;

            // Word count tracking
            textInput.addEventListener('input', function() {
                const text = this.value.trim();
                const words = text === '' ? 0 : text.split(/\s+/).length;
                wordCount.textContent = `${words} words (minimum: 50)`;
                
                if (words >= 50) {
                    wordCount.className = 'word-count';
                    analyzeTextBtn.disabled = false;
                } else if (words >= 25) {
                    wordCount.className = 'word-count warning';
                    analyzeTextBtn.disabled = true;
                } else {
                    wordCount.className = 'word-count error';
                    analyzeTextBtn.disabled = true;
                }
            });

            // Load sample text
            document.getElementById('sampleTextBtn').addEventListener('click', function() {
                const sampleText = `Photosynthesis is the process used by plants, algae, and some bacteria to convert light energy into chemical energy. This process occurs in chloroplasts and involves two main stages: the light-dependent reactions and the Calvin cycle.

Light-dependent Reactions:
These reactions occur in the thylakoid membranes of chloroplasts. Chlorophyll absorbs light energy, which splits water molecules into oxygen, protons, and electrons. The energy from these reactions is stored in ATP and NADPH.

Calvin Cycle:
Also known as the light-independent reactions, this cycle takes place in the stroma of chloroplasts. Here, carbon dioxide is fixed and converted into glucose using the ATP and NADPH produced in the light reactions. The enzyme RuBisCO catalyzes the first major step of carbon fixation.

Importance of Photosynthesis:
Photosynthesis is crucial for life on Earth as it produces oxygen and forms the base of most food chains. The overall chemical equation is: 6CO₂ + 6H₂O + light energy → C₆H₁₂O₆ + 6O₂.

Factors Affecting Photosynthesis:
Light intensity, carbon dioxide concentration, temperature, and water availability all affect the rate of photosynthesis. Plants have adapted various mechanisms to optimize photosynthesis, such as C4 and CAM pathways in plants living in hot, dry environments.`;
                
                textInput.value = sampleText;
                textInput.dispatchEvent(new Event('input'));
            });

            // Start diagnostic
            document.getElementById('startBtn').addEventListener('click', function() {
                document.getElementById('diagnostic').scrollIntoView({ behavior: 'smooth' });
                textInput.focus();
            });

            // Analyze text and generate quiz
            analyzeTextBtn.addEventListener('click', function() {
                const text = textInput.value.trim();
                
                if (text.split(/\s+/).length < 50) {
                    showError('Please enter at least 50 words for analysis.');
                    return;
                }
                
                // Show processing
                processingArea.style.display = 'block';
                analyzeTextBtn.disabled = true;
                
                // Simulate AI processing (in real app, this would be server-side)
                setTimeout(() => {
                    try {
                        // Analyze text
                        aiEngine.extractConcepts(text);
                        aiEngine.identifyTopics(text);
                        
                        // Generate quiz
                        const questions = aiEngine.generateQuestions();
                        
                        // Show success
                        showSuccess(`Analysis complete! Generated ${questions.length} diagnostic questions.`);
                        
                        // Start quiz
                        startQuiz(questions);
                        
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        processingArea.style.display = 'none';
                        analyzeTextBtn.disabled = false;
                    }
                }, 2000);
            });

            // Start quiz
            function startQuiz(questions) {
                if (!questions || questions.length === 0) return;
                
                quizSection.style.display = 'block';
                currentQuestion = 0;
                userAnswers = {};
                quizStartTime = Date.now();
                
                // Store questions
                aiEngine.questions = questions;
                
                // Start timer
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
                
                // Initialize quiz
                renderQuestion();
                updateNavigation();
                
                // Scroll to quiz
                quizSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Render question
            function renderQuestion() {
                const questions = aiEngine.questions;
                if (!questions || !questions[currentQuestion]) return;
                
                const question = questions[currentQuestion];
                progressText.textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
                
                // Calculate progress
                const progress = ((currentQuestion + 1) / questions.length) * 100;
                quizProgress.style.width = `${progress}%`;
                
                // Create question HTML
                const typeClass = question.type;
                const typeIcon = question.type === 'conceptual' ? 'fa-lightbulb' :
                               question.type === 'application' ? 'fa-cogs' : 'fa-brain';
                
                let optionsHTML = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                question.options.forEach((option, index) => {
                    let optionClass = 'option';
                    const qid = question.id.toString();
                    if (userAnswers[qid] === index) {
                        optionClass += ' selected';
                    }
                    
                    optionsHTML += `
                        <div class="${optionClass}" data-index="${index}" data-question="${qid}">
                            <div class="option-letter">${letters[index]}</div>
                            <div class="option-text">${option}</div>
                        </div>
                    `;
                });
                
                quizQuestions.innerHTML = `
                    <div class="quiz-question">
                        <div class="question-meta">
                            <div class="question-type ${typeClass}">
                                <i class="fas ${typeIcon}"></i> ${question.type.charAt(0).toUpperCase() + question.type.slice(1)}
                            </div>
                            <div>
                                <i class="fas fa-tag"></i> ${question.concept}
                            </div>
                        </div>
                        <div class="question-text">
                            ${question.text}
                        </div>
                        <div class="options-grid">
                            ${optionsHTML}
                        </div>
                    </div>
                `;
                
                // Add event listeners to options
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedIndex = parseInt(this.getAttribute('data-index'));
                        const questionId = this.getAttribute('data-question');
                        
                        // Remove selected class from all options in this question
                        document.querySelectorAll(`[data-question="${questionId}"]`).forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Add selected class to clicked option
                        this.classList.add('selected');
                        
                        // Save answer
                        userAnswers[questionId] = selectedIndex;
                        
                        // Enable submit button if all questions answered
                        const allAnswered = Object.keys(userAnswers).length === aiEngine.questions.length;
                        submitQuizBtn.style.display = allAnswered ? 'block' : 'none';
                    });
                });
            }

            // Navigation
            nextQuestionBtn.addEventListener('click', () => {
                if (currentQuestion < aiEngine.questions.length - 1) {
                    currentQuestion++;
                    renderQuestion();
                    updateNavigation();
                }
            });

            prevQuestionBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                    updateNavigation();
                }
            });

            function updateNavigation() {
                prevQuestionBtn.disabled = currentQuestion === 0;
                nextQuestionBtn.disabled = currentQuestion === aiEngine.questions.length - 1;
            }

            // Timer
            function updateTimer() {
                if (!quizStartTime) return;
                
                const now = Date.now();
                const diff = Math.floor((now - quizStartTime) / 1000);
                const minutes = Math.floor(diff / 60);
                const seconds = diff % 60;
                
                document.getElementById('quizTime').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // Submit quiz
            submitQuizBtn.addEventListener('click', function() {
                if (!aiEngine.questions) return;
                
                clearInterval(timerInterval);
                const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
                
                submitQuizBtn.disabled = true;
                submitQuizBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
                
                // Analyze responses
                setTimeout(() => {
                    try {
                        const analysis = aiEngine.analyzeResponses(userAnswers, timeTaken);
                        showResults(analysis);
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        submitQuizBtn.disabled = false;
                        submitQuizBtn.innerHTML = '<i class="fas fa-chart-line"></i> Submit Quiz & Get Analysis';
                    }
                }, 1500);
            });

            // Show results
            function showResults(analysis) {
                quizSection.style.display = 'none';
                resultsSection.style.display = 'block';
                
                const profile = analysis.profile;
                
                // Create topics HTML
                let topicsHTML = '';
                
                if (analysis.strongConcepts && analysis.strongConcepts.length > 0) {
                    analysis.strongConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item strong">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--success);">Strong</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">You understand this well</p>
                            </div>
                        `;
                    });
                }
                
                if (analysis.weakConcepts && analysis.weakConcepts.length > 0) {
                    analysis.weakConcepts.forEach(concept => {
                        topicsHTML += `
                            <div class="topic-item weak">
                                <div class="topic-header">
                                    <strong>${concept}</strong>
                                    <span style="font-weight: 700; color: var(--danger);">Needs Work</span>
                                </div>
                                <p style="color: var(--gray); margin-top: 8px; font-size: 0.9rem;">Focus on this area</p>
                            </div>
                        `;
                    });
                }
                
                // Create study plan HTML
                let studyPlanHTML = '';
                if (analysis.recommendations.studyPlan) {
                    analysis.recommendations.studyPlan.forEach((step, index) => {
                        studyPlanHTML += `
                            <li>${step}</li>
                        `;
                    });
                }
                
                resultsSection.innerHTML = `
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-icon" style="background: linear-gradient(135deg, ${profile.color}, ${profile.color}dd);">
                                <i class="fas ${profile.icon}"></i>
                            </div>
                            <div style="flex: 1;">
                                <h2 style="color: var(--secondary); margin-bottom: 10px;">Your Learning Profile</h2>
                                <h3 style="color: ${profile.color}; margin-bottom: 10px;">${profile.type} Learner</h3>
                                <p style="color: var(--gray); line-height: 1.6;">${profile.description}</p>
                            </div>
                        </div>
                        
                        <div class="confidence-meter">
                            <div class="meter-label">
                                <span style="font-size: 1.1rem;">Diagnostic Score</span>
                                <strong style="font-size: 1.5rem; color: ${analysis.accuracy >= 70 ? 'var(--success)' : analysis.accuracy >= 50 ? 'var(--warning)' : 'var(--danger)'};">${analysis.accuracy.toFixed(1)}%</strong>
                            </div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: ${analysis.accuracy}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: var(--gray); font-size: 0.9rem;">
                                <span>${analysis.correct} correct</span>
                                <span>${analysis.total} total questions</span>
                            </div>
                        </div>
                    </div>
                    
                    ${topicsHTML ? `
                    <div class="profile-card">
                        <h3 style="color: var(--secondary); margin-bottom: 20px;">
                            <i class="fas fa-chart-bar"></i> Concept Analysis
                        </h3>
                        <div class="topics-breakdown">
                            ${topicsHTML}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="study-plan">
                        <div class="technique-recommendation">
                            <div class="tech-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--secondary); margin-bottom: 10px;">Personalized Study Plan</h3>
                                <p style="color: var(--gray);">Recommended techniques: <strong>${analysis.recommendations.techniques.join(', ')}</strong></p>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--secondary); margin: 20px 0 15px;">Action Steps:</h4>
                        <ol class="steps-list">
                            ${studyPlanHTML}
                        </ol>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 25px 0;">
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--secondary); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-clock"></i> Schedule</h4>
                                <p style="font-size: 0.9rem; color: var(--gray);">${analysis.recommendations.dailyTime}</p>
                                <p style="font-size: 0.9rem; color: var(--gray);">Focus: ${analysis.recommendations.focusRatio}</p>
                            </div>
                            <div style="background: #fff5f5; padding: 15px; border-radius: 8px;">
                                <h4 style="color: var(--danger); margin-bottom: 8px; font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> Avoid</h4>
                                <ul style="padding-left: 20px; font-size: 0.9rem; color: var(--gray);">
                                    ${analysis.recommendations.avoid.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn btn-primary" id="newDiagnosticBtn">
                                <i class="fas fa-redo"></i> Start New Diagnostic
                            </button>
                        </div>
                    </div>
                `;
                
                // Add event listener to new diagnostic button
                document.getElementById('newDiagnosticBtn').addEventListener('click', function() {
                    location.reload();
                });
                
                // Animate progress bar
                setTimeout(() => {
                    const fill = document.querySelector('.meter-fill');
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                }, 300);
                
                // Scroll to results
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            // Utility functions
            function showError(message) {
                errorAlert.textContent = message;
                errorAlert.style.display = 'block';
                setTimeout(() => {
                    errorAlert.style.display = 'none';
                }, 5000);
            }

            function showSuccess(message) {
                successAlert.textContent = message;
                successAlert.style.display = 'block';
                setTimeout(() => {
                    successAlert.style.display = 'none';
                }, 5000);
            }

            // Initialize
            textInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
